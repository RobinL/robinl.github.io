{"version":3,"file":"component---src-mdx-archived-maths-fellegi-sunter-mdx-22806fbc35f274156341.js","mappings":"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","sources":["webpack://robinlinacre/./node_modules/@robinl/86fc30325e4106c4/79750b3b8e929d9d@209.js","webpack://robinlinacre/./node_modules/@robinl/86fc30325e4106c4/ef62bc8f8c0d577e@90.js","webpack://robinlinacre/./node_modules/@robinl/86fc30325e4106c4/843cb6e82d7c3d9b@474.js","webpack://robinlinacre/./node_modules/@robinl/86fc30325e4106c4/d25176b0fe784ad0@488.js","webpack://robinlinacre/./node_modules/@robinl/86fc30325e4106c4/ea6530af059f37be@231.js","webpack://robinlinacre/./node_modules/@robinl/86fc30325e4106c4/86fc30325e4106c4@851.js","webpack://robinlinacre/./src/mdx/archived_maths_fellegi_sunter.mdx","webpack://robinlinacre/./src/components/CompactTutorialNav.jsx","webpack://robinlinacre/./src/components/ObservableNotebook.jsx","webpack://robinlinacre/./src/components/ProbLinkageLayout.jsx","webpack://robinlinacre/./src/hooks/use-site-metadata.jsx","webpack://robinlinacre/./src/components/SEO.jsx","webpack://robinlinacre/./src/components/TutorialNav.jsx"],"sourcesContent":["function _1(md){return(\nmd`# Arquero\n\nArquero is a library for query processing and transformation of array-backed data tables. Following the [relational algebra](https://en.wikipedia.org/wiki/Relational_algebra) and inspired by the design of [dplyr](https://dplyr.tidyverse.org/), Arquero provides a fluent API for manipulating column-oriented data frames. Arquero supports a range of data transformation tasks, including filter, sample, aggregation, window, join, and reshaping operations. Arquero is Spanish for \"archer\": if datasets are [arrows](https://observablehq.com/@theneuralbit/introduction-to-apache-arrow), Arquero helps their aim stay true.`\n)}\n\nfunction _2(md){return(\nmd`Import Arquero and extend it to print HTML tables in Observable:`\n)}\n\nasync function _aq(require,aq_version,aq_packages,toView)\n{\n  const aq = await require(`arquero@${aq_version}`);\n\n  // load and install any additional packages\n  (await Promise.all(aq_packages.map(pkg => require(pkg))))\n    .forEach(pkg => aq.addPackage(pkg));\n\n  // Add HTML table view method to tables\n  aq.addTableMethod('view', toView, { override: true });\n\n  return aq;\n}\n\n\nfunction _aq_version(){return(\n'4.2.0'\n)}\n\nfunction _aq_packages(){return(\n[]\n)}\n\nfunction _6(md){return(\nmd`Export a global reference to Arquero operations:`\n)}\n\nfunction _op(aq){return(\naq.op\n)}\n\nfunction _8(md){return(\nmd`To use the same setup in your own notebooks, add a cell with the following code:\n~~~ js\nimport { aq, op } from '@uwdata/arquero'\n~~~\n`\n)}\n\nfunction _9(md){return(\nmd`To get started, see the [Introducing Arquero](https://observablehq.com/@uwdata/introducing-arquero) and [Arquero Cookbook](https://observablehq.com/@uwdata/arquero-cookbook) notebooks.`\n)}\n\nfunction _10(md){return(\nmd`To use Arquero outside of Observable, see [https://github.com/uwdata/arquero](https://github.com/uwdata/arquero).`\n)}\n\nfunction _11(md){return(\nmd`<hr>\n## Examples\n\nThe core abstractions in Arquero are *data tables*, which model each column as an array of values, and *verbs* that transform data and return new tables. Verbs are table methods, allowing method chaining for multi-step transformations. Though each table is unique, many verbs reuse the underlying columns to limit duplication.\n`\n)}\n\nfunction _12(md){return(\nmd`Average hours of sunshine per month, from [https://usclimatedata.com/](https://usclimatedata.com/):`\n)}\n\nfunction _dt(aq){return(\naq.table({\n  'Seattle': [69, 108, 178, 207, 253, 268, 312, 281, 221, 142, 72, 52],\n  'Chicago': [135, 136, 187, 215, 281, 311, 318, 283, 226, 193, 113, 106],\n  'San Francisco': [165, 182, 251, 281, 314, 330, 300, 272, 267, 243, 189, 156]\n})\n)}\n\nfunction _14(md){return(\nmd`Sorted differences between Seattle and Chicago:`\n)}\n\nfunction _15(dt,op){return(\ndt.derive({\n    month: d => op.row_number(),\n    diff:  d => d.Seattle - d.Chicago\n  })\n  .select('month', 'diff')\n  .orderby('month')\n  .view({ height: 400 })\n)}\n\nfunction _16(md){return(\nmd`Is Seattle more correlated with San Francisco or Chicago?`\n)}\n\nfunction _17(dt,op){return(\ndt.rollup({\n    corr_sf:  op.corr('Seattle', 'San Francisco'),\n    corr_chi: op.corr('Seattle', 'Chicago')\n  })\n  .view()\n)}\n\nfunction _18(md){return(\nmd`Summary statistics per city, as output objects:`\n)}\n\nfunction _19(dt,aq,op){return(\ndt.fold(aq.all(), { as: ['city', 'sun'] })\n  .groupby('city')\n  .rollup({\n    min:  d => op.min(d.sun), // functional form of op.min('sun')\n    max:  d => op.max(d.sun),\n    avg:  d => op.average(d.sun),\n    med:  d => op.median(d.sun),\n    // functional forms permit flexible table expressions\n    skew: ({sun: s}) => (op.mean(s) - op.median(s)) / op.stdev(s) || 0\n  })\n  .objects()\n)}\n\nfunction _20(md){return(\nmd`<hr>\n## Utilities\n`\n)}\n\nfunction _toView(html)\n{\n  const DEFAULT_LIMIT = 100;\n  const DEFAULT_NULL = value => `<span style=\"color: #999;\">${value}</span>`;\n  const tableStyle = 'margin: 0; border-collapse: collapse; width: initial;';\n  const cellStyle = 'padding: 1px 5px; white-space: nowrap; overflow-x: hidden; text-overflow: ellipsis; font-variant-numeric: tabular-nums;';\n\n  // extend table prototype to provide an HTML table view\n  return function(dt, opt = {}) {\n    // permit shorthand for limit\n    if (typeof opt === 'number') opt = { limit: opt };\n    \n    // marshal cell color options\n    const color = { ...opt.color };\n    if (typeof opt.color === 'function') {\n      // if function, apply to all columns\n      dt.columnNames().forEach(name => color[name] = opt.color);\n    } else {\n      // otherwise, gather per-column color options\n      for (const key in color) {\n        const value = color[key];\n        color[key] = typeof value === 'function' ? value : () => value;\n      }\n    }\n\n    // marshal CSS styles as toHTML() options\n    const table = `${tableStyle}`;\n    const td = (name, index, row) => {\n      return `${cellStyle} max-width: ${+opt.maxCellWidth || 300}px;`\n        + (color[name] ? ` background-color: ${color[name](index, row)};` : '');\n    };\n\n    opt = {\n      limit: DEFAULT_LIMIT,\n      null: DEFAULT_NULL,\n      ...opt,\n      style: { table, td, th: td }\n    };\n\n    // return container div, bind table value to support viewof operator\n    const size = `max-height: ${+opt.height || 270}px`;\n    const style = `${size}; overflow-x: auto; overflow-y: auto;`;\n    const view = html`<div style=\"${style}\">${dt.toHTML(opt)}</div>`;\n    view.value = dt;\n    return view;\n  };\n}\n\n\nexport default function define(runtime, observer) {\n  const main = runtime.module();\n  main.variable(observer()).define([\"md\"], _1);\n  main.variable(observer()).define([\"md\"], _2);\n  main.variable(observer(\"aq\")).define(\"aq\", [\"require\",\"aq_version\",\"aq_packages\",\"toView\"], _aq);\n  main.variable(observer(\"aq_version\")).define(\"aq_version\", _aq_version);\n  main.variable(observer(\"aq_packages\")).define(\"aq_packages\", _aq_packages);\n  main.variable(observer()).define([\"md\"], _6);\n  main.variable(observer(\"op\")).define(\"op\", [\"aq\"], _op);\n  main.variable(observer()).define([\"md\"], _8);\n  main.variable(observer()).define([\"md\"], _9);\n  main.variable(observer()).define([\"md\"], _10);\n  main.variable(observer()).define([\"md\"], _11);\n  main.variable(observer()).define([\"md\"], _12);\n  main.variable(observer(\"dt\")).define(\"dt\", [\"aq\"], _dt);\n  main.variable(observer()).define([\"md\"], _14);\n  main.variable(observer()).define([\"dt\",\"op\"], _15);\n  main.variable(observer()).define([\"md\"], _16);\n  main.variable(observer()).define([\"dt\",\"op\"], _17);\n  main.variable(observer()).define([\"md\"], _18);\n  main.variable(observer()).define([\"dt\",\"aq\",\"op\"], _19);\n  main.variable(observer()).define([\"md\"], _20);\n  main.variable(observer(\"toView\")).define(\"toView\", [\"html\"], _toView);\n  return main;\n}\n","import define1 from \"./79750b3b8e929d9d@209.js\";\n\nfunction _1(md){return(\nmd`# Record Utilities`\n)}\n\nfunction _Record(aq){return(\nclass Record {\n  constructor(record_dict) {\n    this.record_dict = record_dict;\n  }\n\n  as_dict() {\n    return this.record_dict\n  }\n\n  as_aq() {\n    return aq.from([this.record_dict]);\n  }\n\n  display() {\n    return this.as_aq().view();\n  }\n}\n)}\n\nfunction _RecordComparison(aq){return(\nclass RecordComparison {\n  constructor(record_l, record_r) {\n    this.record_l = record_l;\n    this.record_r = record_r;\n  }\n\n  as_long() {\n    let records = [this.record_l.as_dict(), this.record_r.as_dict()];\n    return aq.from(records);\n  }\n\n  as_wide() {\n    let t_l = this.record_l.as_aq();\n    let t_r = this.record_r.as_aq();\n\n    let comparison = t_l.join(t_r, (a, b) => true, null, {\n      suffix: [\"_l\", \"_r\"]\n    });\n\n    // Group columns\n    let colname_no_suffix = t_l.columnNames();\n\n    let cols_ordered = [];\n    colname_no_suffix.forEach((d) => {\n      cols_ordered.push(d + \"_l\");\n      cols_ordered.push(d + \"_r\");\n    });\n\n    comparison = comparison.select(cols_ordered);\n    return comparison;\n  }\n\n  display(wide_or_long = \"long\") {\n    if (wide_or_long == \"long\") {\n      return this.as_long().view();\n    } else if (wide_or_long == \"wide\") {\n      return this.as_wide().view();\n    }\n  }\n}\n)}\n\nexport default function define(runtime, observer) {\n  const main = runtime.module();\n  main.variable(observer()).define([\"md\"], _1);\n  main.variable(observer(\"Record\")).define(\"Record\", [\"aq\"], _Record);\n  main.variable(observer(\"RecordComparison\")).define(\"RecordComparison\", [\"aq\"], _RecordComparison);\n  const child1 = runtime.module(define1);\n  main.import(\"aq\", child1);\n  main.import(\"op\", child1);\n  return main;\n}\n","function _1(md){return(\nmd`# Waterfall chart`\n)}\n\nfunction _2(md){return(\nmd`### Objective\n\nTake \n- a Splink settings object \n- A row of data from \\`df_e\\`\nAnd turn it into the data needed for the waterfall chart.\n\n`\n)}\n\nfunction _3(md){return(\nmd`## Example`\n)}\n\nfunction _splink_settings()\n{\n  return {\n    proportion_of_matches: 1 / 100,\n    comparison_columns: [\n      {\n        num_levels: 3,\n        col_name: \"first_name\",\n        u_probabilities: [0.8, 0.2],\n        m_probabilities: [0.2, 0.8]\n      },\n      {\n        num_levels: 3,\n        col_name: \"surname\",\n        u_probabilities: [0.8, 0.2],\n        m_probabilities: [0.2, 0.8]\n      },\n      {\n        col_name: \"date_of_birth\",\n        u_probabilities: [0.99, 0.01],\n        m_probabilities: [0.2, 0.8]\n      }\n    ]\n  };\n}\n\n\nfunction _row()\n{\n  return {\n    first_name_l: \"John\",\n    first_name_r: \"John\",\n    𝛾_first_name: 1,\n    surname_l: \"Smith\",\n    surname_r: \"Smith\",\n    𝛾_surname: 1,\n    date_of_birth_l: \"1992-04-01\",\n    date_of_birth_l: \"1992-04-02\",\n    𝛾_date_of_birth: 0,\n    other: \"hi\"\n  };\n}\n\n\nfunction _overrides()\n{\n  return { height: 200 };\n}\n\n\nfunction _7(get_waterfall_chart,row,splink_settings,overrides){return(\nget_waterfall_chart(row, splink_settings, overrides, true)\n)}\n\nfunction _8(get_waterfall_chart,row,splink_settings,overrides){return(\nget_waterfall_chart(row, splink_settings, overrides, false)\n)}\n\nfunction _9(md){return(\nmd`## Code`\n)}\n\nfunction _get_waterfall_chart(get_waterfall_chart_data,embed,get_chart_spec){return(\nfunction (\n  row,\n  splink_settings,\n  chart_overrides,\n  simplified,\n  term_freqs = {}\n) {\n  let data = get_waterfall_chart_data(row, splink_settings, term_freqs);\n\n  return embed(get_chart_spec(data, chart_overrides, simplified));\n}\n)}\n\nfunction _get_comparison_column_lookup(){return(\nfunction get_comparison_column_lookup(splink_settings) {\n  let lookup = {};\n  splink_settings.comparison_columns.forEach((d) => {\n    let col_name = d[\"col_name\"];\n    lookup[col_name] = d;\n  });\n  return lookup;\n}\n)}\n\nfunction _get_waterfall_chart_data(get_waterfall_data_lambda_row,get_waterfall_data_other_rows,get_waterfall_data_final_row){return(\nfunction get_waterfall_chart_data(row, splink_settings, term_freqs = {}) {\n  \n  let lambda_row = get_waterfall_data_lambda_row(splink_settings);\n  let waterfall_data_other_rows = get_waterfall_data_other_rows(\n    row,\n    splink_settings,\n    term_freqs\n  );\n\n  let rows_except_final = [lambda_row].concat(waterfall_data_other_rows);\n  let final_row = get_waterfall_data_final_row(splink_settings);\n\n  let cumulative_log2_bayes_factor = rows_except_final.reduce(\n    (a, b) => a + b[\"log2_bayes_factor\"],\n    0\n  );\n\n  final_row[\"bayes_factor\"] = 2 ** cumulative_log2_bayes_factor;\n  final_row[\"log2_bayes_factor\"] = cumulative_log2_bayes_factor;\n\n  return rows_except_final.concat([final_row]);\n}\n)}\n\nfunction _get_waterfall_row_gamma(get_comparison_column_lookup,log2){return(\nfunction get_waterfall_row_gamma(gamma_key, row, splink_settings, term_freqs) {\n  let key = gamma_key;\n  let gamma_value = row[key];\n  let col_name = key.replace(\"𝛾_\", \"\");\n  let cc_lookup = get_comparison_column_lookup(splink_settings);\n  let this_cc = cc_lookup[col_name];\n\n  let value_l = row[col_name + \"_l\"];\n  let value_r = row[col_name + \"_r\"];\n\n  let u_probability, m_probability;\n  if (gamma_value == -1) {\n    u_probability = 0.5;\n    m_probability = 0.5;\n  } else {\n    u_probability = this_cc[\"u_probabilities\"][gamma_value];\n    m_probability = this_cc[\"m_probabilities\"][gamma_value];\n\n    if (value_l == value_r) {\n      if (col_name in term_freqs) {\n        let tfs = term_freqs[col_name];\n        u_probability = tfs[value_l] || u_probability;\n      }\n    }\n  }\n\n  let bayes_factor = m_probability / u_probability;\n\n  return {\n    bayes_factor: bayes_factor,\n    column_name: col_name,\n    gamma_column_name: \"𝛾_\" + col_name,\n    gamma_index: gamma_value,\n\n    level_name: \"level_\" + gamma_value,\n\n    log2_bayes_factor: log2(bayes_factor),\n    m_probability: m_probability,\n\n    num_levels: null,\n    u_probability: u_probability,\n    value_l: value_l,\n    value_r: value_r\n  };\n}\n)}\n\nfunction _get_waterfall_data_lambda_row(prob_to_bayes_factor,prob_to_log2_bayes_factor){return(\nfunction (splink_settings) {\n  let row = {\n    bayes_factor: prob_to_bayes_factor(splink_settings.proportion_of_matches),\n    column_name: \"Prior\",\n    gamma_column_name: \"\",\n    gamma_index: \"\",\n\n    level_name: null,\n\n    log2_bayes_factor: prob_to_log2_bayes_factor(\n      splink_settings.proportion_of_matches\n    ),\n    m_probability: null,\n\n    num_levels: null,\n    u_probability: null,\n    value_l: \"\",\n    value_r: \"\"\n  };\n\n  return row;\n}\n)}\n\nfunction _get_waterfall_data_other_rows(get_waterfall_row_gamma){return(\nfunction (row, splink_settings, term_freqs) {\n  let keys = Object.keys(row);\n  keys = keys.filter((key) => key.includes(\"𝛾_\"));\n  return keys.map((gamma_key) =>\n    get_waterfall_row_gamma(gamma_key, row, splink_settings, term_freqs)\n  );\n}\n)}\n\nfunction _get_waterfall_data_final_row(){return(\nfunction (splink_settings) {\n  let row = {\n    bayes_factor: null,\n    column_name: \"Final score\",\n    gamma_column_name: \"\",\n    gamma_index: \"\",\n\n    level_name: null,\n\n    log2_bayes_factor: null,\n    m_probability: null,\n\n    num_levels: null,\n    u_probability: null,\n    value_l: \"\",\n    value_r: \"\"\n  };\n\n  return row;\n}\n)}\n\nfunction _get_chart_spec(base_spec){return(\nfunction (data, overrides, simplified = false) {\n  let base_spec_2 = JSON.parse(JSON.stringify(base_spec));\n  // let base_spec_2 = Object.assign({}, base_spec);\n  base_spec_2.data.values = data;\n  let spec = { ...base_spec_2, ...overrides };\n  if (simplified) {\n    // Remove right hand axis\n    spec[\"layer\"][1][\"encoding\"][\"y\"][\"axis\"] = false;\n\n    // Remove bayes factor text overlays\n    // spec[\"layer\"][0][\"layer\"].splice(2, 1);\n    spec[\"layer\"][0][\"layer\"][2][\"encoding\"][\"text\"] = {\n      type: \"nominal\",\n      field: \"up_down_emoji\"\n    };\n    spec[\"layer\"][0][\"layer\"][2][\"encoding\"][\"opacity\"] = {\n      condition: {\n        value: 0,\n        test:\n          \"datum.column_name == 'Final score' || datum.column_name == 'Prior'\"\n      }\n    };\n\n    // Make left hand side axis probability\n    let expr = \"format(1 / (1 + pow(2, -1*datum.value)), '.2r')\";\n    spec[\"layer\"][0][\"layer\"][1][\"encoding\"][\"y\"][\"axis\"][\"labelExpr\"] = expr;\n    spec[\"layer\"][0][\"layer\"][1][\"encoding\"][\"y\"][\"axis\"][\"title\"] =\n      \"probability\";\n\n    // Tooltip\n\n    spec[\"layer\"][0][\"layer\"][1][\"encoding\"][\"tooltip\"] = [\n      {\n        type: \"quantitative\",\n        field: \"prob\",\n        format: \".3r\",\n        title: \"Cumulative match probability\"\n      }\n    ];\n  }\n\n  return spec;\n}\n)}\n\nfunction _base_spec()\n{\n  return {\n    config: { view: { continuousHeight: 300, continuousWidth: 400 } },\n    title: {\n      text: \"Bayes factor intuition chart\",\n      subtitle:\n        \"How each comparison column contributes to the final match score\"\n    },\n    transform: [\n      { filter: \"(datum.bayes_factor !== 1.0)\" },\n      {\n        window: [\n          { op: \"sum\", field: \"log2_bayes_factor\", as: \"sum\" },\n          { op: \"lead\", field: \"column_name\", as: \"lead\" }\n        ],\n        frame: [null, 0]\n      },\n      {\n        calculate:\n          'datum.column_name === \"Final score\" ? datum.sum - datum.log2_bayes_factor : datum.sum',\n        as: \"sum\"\n      },\n      {\n        calculate: \"datum.lead === null ? datum.column_name : datum.lead\",\n        as: \"lead\"\n      },\n      {\n        calculate:\n          'datum.column_name === \"Final score\" || datum.column_name === \"Prior lambda\" ? 0 : datum.sum - datum.log2_bayes_factor',\n        as: \"previous_sum\"\n      },\n      {\n        calculate: 'datum.sum > datum.previous_sum ? datum.column_name : \"\"',\n        as: \"top_label\"\n      },\n      {\n        calculate: 'datum.sum < datum.previous_sum ? datum.column_name : \"\"',\n        as: \"bottom_label\"\n      },\n      {\n        calculate:\n          \"datum.sum > datum.previous_sum ? datum.sum : datum.previous_sum\",\n        as: \"sum_top\"\n      },\n      {\n        calculate:\n          \"datum.sum < datum.previous_sum ? datum.sum : datum.previous_sum\",\n        as: \"sum_bottom\"\n      },\n      { calculate: \"(datum.sum + datum.previous_sum) / 2\", as: \"center\" },\n      {\n        calculate:\n          '(datum.log2_bayes_factor > 0 ? \"+\" : \"\") + datum.log2_bayes_factor',\n        as: \"text_log2_bayes_factor\"\n      },\n      { calculate: \"datum.sum < datum.previous_sum ? 4 : -4\", as: \"dy\" },\n      {\n        calculate: 'datum.sum < datum.previous_sum ? \"top\" : \"bottom\"',\n        as: \"baseline\"\n      },\n      { calculate: \"1. / (1 + pow(2, -1.*datum.sum))\", as: \"prob\" },\n      { calculate: \"0*datum.sum\", as: \"zero\" },\n      {\n        calculate: 'datum.sum > datum.previous_sum ? \"↑\" : \"↓\"',\n        as: \"up_down_emoji\"\n      }\n    ],\n    layer: [\n      {\n        layer: [\n          {\n            mark: \"rule\",\n            encoding: {\n              y: { field: \"zero\", type: \"quantitative\" },\n              size: { value: 0.5 },\n              color: { value: \"black\" }\n            }\n          },\n          {\n            mark: { type: \"bar\", width: 60 },\n            encoding: {\n              color: {\n                condition: {\n                  value: \"red\",\n                  test: \"(datum.log2_bayes_factor < 0)\"\n                },\n                value: \"green\"\n              },\n              opacity: {\n                condition: {\n                  value: 1,\n                  test:\n                    \"datum.column_name == 'Prior' || datum.column_name == 'Final score'\"\n                },\n                value: 0.5\n              },\n              tooltip: [\n                {\n                  type: \"nominal\",\n                  field: \"column_name\",\n                  title: \"Comparison column\"\n                },\n                { type: \"nominal\", field: \"value_l\", title: \"Value (L)\" },\n                { type: \"nominal\", field: \"value_r\", title: \"Value (R)\" },\n                { type: \"nominal\", field: \"gamma_index\", title: \"Gamma level\" },\n\n                {\n                  type: \"quantitative\",\n                  field: \"bayes_factor\",\n                  format: \".3r\",\n                  title: \"Bayes factor\"\n                },\n                {\n                  type: \"quantitative\",\n                  field: \"log2_bayes_factor\",\n                  format: \".3r\",\n                  title: \"log2(Bayes factor)\"\n                },\n                {\n                  type: \"quantitative\",\n                  field: \"prob\",\n                  format: \".3r\",\n                  title: \"Cumulative match probability\"\n                }\n              ],\n              x: {\n                type: \"nominal\",\n                axis: {\n                  labelExpr:\n                    \"datum.value == 'Prior' || datum.value == 'Final score' ? '' : datum.value\",\n\n                  labelAlign: \"center\",\n                  labelPadding: 10,\n                  title: \"Column\",\n                  grid: true,\n                  tickBand: \"extent\"\n                },\n                field: \"column_name\",\n                sort: null\n              },\n              y: {\n                type: \"quantitative\",\n                axis: {\n                  grid: false,\n                  orient: \"left\",\n                  title: \"log2(Bayes factor)\"\n                },\n                field: \"previous_sum\"\n              },\n              y2: { field: \"sum\" }\n            }\n          },\n          {\n            mark: { type: \"text\", fontWeight: \"bold\" },\n            encoding: {\n              color: { value: \"white\" },\n              text: {\n                condition: {\n                  type: \"nominal\",\n                  field: \"log2_bayes_factor\",\n                  format: \".2f\",\n                  test: \"abs(datum.log2_bayes_factor) > 1\"\n                },\n                value: \"\"\n              },\n              x: {\n                type: \"nominal\",\n                axis: { labelAngle: 0, title: \"Column\" },\n                field: \"column_name\",\n                sort: null\n              },\n              y: {\n                type: \"quantitative\",\n                axis: { orient: \"left\" },\n                field: \"center\"\n              }\n            }\n          },\n          {\n            mark: {\n              type: \"text\",\n              baseline: \"bottom\",\n              dy: -5,\n              fontWeight: \"bold\"\n            },\n            encoding: {\n              color: { value: \"black\" },\n              text: {\n                condition: {\n                  type: \"nominal\",\n                  field: \"top_label\",\n                  test: \"abs(datum.log2_bayes_factor) > 1\"\n                },\n                value: \"\"\n              },\n              x: {\n                type: \"nominal\",\n                axis: { labelAngle: 0, title: \"Column\" },\n                field: \"column_name\",\n                sort: null\n              },\n              y: { type: \"quantitative\", field: \"sum_top\" }\n            }\n          },\n          {\n            mark: { type: \"text\", baseline: \"top\", dy: 5, fontWeight: \"bold\" },\n            encoding: {\n              color: { value: \"black\" },\n              text: {\n                condition: {\n                  type: \"nominal\",\n                  field: \"bottom_label\",\n                  test: \"abs(datum.log2_bayes_factor) > 1\"\n                },\n                value: \"\"\n              },\n              x: {\n                type: \"nominal\",\n                axis: { labelAngle: 0, title: \"Column\" },\n                field: \"column_name\",\n                sort: null\n              },\n              y: { type: \"quantitative\", field: \"sum_bottom\" }\n            }\n          }\n        ]\n      },\n      {\n        mark: {\n          type: \"rule\",\n          color: \"black\",\n          strokeWidth: 2,\n          x2Offset: 30,\n          xOffset: -30\n        },\n        encoding: {\n          x: {\n            type: \"nominal\",\n            axis: { labelAngle: 0, title: \"Column\" },\n            field: \"column_name\",\n            sort: null\n          },\n          x2: { field: \"lead\" },\n          y: {\n            type: \"quantitative\",\n            axis: {\n              labelExpr: \"format(1 / (1 + pow(2, -1*datum.value)), '.2r')\",\n              orient: \"right\",\n              title: \"Probability\"\n            },\n            field: \"sum\",\n            scale: { zero: false }\n          }\n        }\n      }\n    ],\n    height: 450,\n    resolve: { axis: { y: \"independent\" } },\n    width: { step: 75 },\n    $schema: \"https://vega.github.io/schema/vega-lite/v4.8.1.json\",\n    data: { values: null }\n  };\n}\n\n\nfunction _embed(require){return(\nrequire(\"vega-embed@6\")\n)}\n\nfunction _bayes_factor_to_prob(){return(\nfunction bayes_factor_to_prob(b) {\n  return b / (b + 1);\n}\n)}\n\nfunction _log2(){return(\nMath.log2\n)}\n\nfunction _prob_to_bayes_factor(){return(\nfunction prob_to_bayes_factor(p) {\n  return p / (1 - p);\n}\n)}\n\nfunction _prob_to_log2_bayes_factor(log2,prob_to_bayes_factor){return(\nfunction prob_to_log2_bayes_factor(p) {\n  return log2(prob_to_bayes_factor(p));\n}\n)}\n\nfunction _log2_bayes_factor_to_prob(bayes_factor_to_prob){return(\nfunction log2_bayes_factor_to_prob(log2_b) {\n  return bayes_factor_to_prob(2 ** log2_b);\n}\n)}\n\nfunction _first_name_lookup(d3)\n{\n  return d3\n    .csv(\n      \"https://gist.githubusercontent.com/RobinL/0ee2e59db8cbecc105942fe4b101e847/raw/110e5bb3b574b7584b5452d4accfcfad71f2b19d/first_name_noyear.csv\",\n      d3.autoType\n    )\n    .then((csv_file) => {\n      let lookup = {};\n      csv_file.forEach((row) => {\n        lookup[row.firstname] = row.freq;\n      });\n      return lookup;\n    });\n}\n\n\nfunction _term_freqs(first_name_lookup)\n{\n  return {\n    first_name: first_name_lookup\n  };\n}\n\n\nexport default function define(runtime, observer) {\n  const main = runtime.module();\n  main.variable(observer()).define([\"md\"], _1);\n  main.variable(observer()).define([\"md\"], _2);\n  main.variable(observer()).define([\"md\"], _3);\n  main.variable(observer(\"splink_settings\")).define(\"splink_settings\", _splink_settings);\n  main.variable(observer(\"row\")).define(\"row\", _row);\n  main.variable(observer(\"overrides\")).define(\"overrides\", _overrides);\n  main.variable(observer()).define([\"get_waterfall_chart\",\"row\",\"splink_settings\",\"overrides\"], _7);\n  main.variable(observer()).define([\"get_waterfall_chart\",\"row\",\"splink_settings\",\"overrides\"], _8);\n  main.variable(observer()).define([\"md\"], _9);\n  main.variable(observer(\"get_waterfall_chart\")).define(\"get_waterfall_chart\", [\"get_waterfall_chart_data\",\"embed\",\"get_chart_spec\"], _get_waterfall_chart);\n  main.variable(observer(\"get_comparison_column_lookup\")).define(\"get_comparison_column_lookup\", _get_comparison_column_lookup);\n  main.variable(observer(\"get_waterfall_chart_data\")).define(\"get_waterfall_chart_data\", [\"get_waterfall_data_lambda_row\",\"get_waterfall_data_other_rows\",\"get_waterfall_data_final_row\"], _get_waterfall_chart_data);\n  main.variable(observer(\"get_waterfall_row_gamma\")).define(\"get_waterfall_row_gamma\", [\"get_comparison_column_lookup\",\"log2\"], _get_waterfall_row_gamma);\n  main.variable(observer(\"get_waterfall_data_lambda_row\")).define(\"get_waterfall_data_lambda_row\", [\"prob_to_bayes_factor\",\"prob_to_log2_bayes_factor\"], _get_waterfall_data_lambda_row);\n  main.variable(observer(\"get_waterfall_data_other_rows\")).define(\"get_waterfall_data_other_rows\", [\"get_waterfall_row_gamma\"], _get_waterfall_data_other_rows);\n  main.variable(observer(\"get_waterfall_data_final_row\")).define(\"get_waterfall_data_final_row\", _get_waterfall_data_final_row);\n  main.variable(observer(\"get_chart_spec\")).define(\"get_chart_spec\", [\"base_spec\"], _get_chart_spec);\n  main.variable(observer(\"base_spec\")).define(\"base_spec\", _base_spec);\n  main.variable(observer(\"embed\")).define(\"embed\", [\"require\"], _embed);\n  main.variable(observer(\"bayes_factor_to_prob\")).define(\"bayes_factor_to_prob\", _bayes_factor_to_prob);\n  main.variable(observer(\"log2\")).define(\"log2\", _log2);\n  main.variable(observer(\"prob_to_bayes_factor\")).define(\"prob_to_bayes_factor\", _prob_to_bayes_factor);\n  main.variable(observer(\"prob_to_log2_bayes_factor\")).define(\"prob_to_log2_bayes_factor\", [\"log2\",\"prob_to_bayes_factor\"], _prob_to_log2_bayes_factor);\n  main.variable(observer(\"log2_bayes_factor_to_prob\")).define(\"log2_bayes_factor_to_prob\", [\"bayes_factor_to_prob\"], _log2_bayes_factor_to_prob);\n  main.variable(observer(\"first_name_lookup\")).define(\"first_name_lookup\", [\"d3\"], _first_name_lookup);\n  main.variable(observer(\"term_freqs\")).define(\"term_freqs\", [\"first_name_lookup\"], _term_freqs);\n  return main;\n}\n","import define1 from \"./79750b3b8e929d9d@209.js\";\n\nfunction _1(md){return(\nmd`# Fellegi Sunter utils`\n)}\n\nfunction _records_l(){return(\n[\n  {\n    uid: \"1_l\",\n    fname: \"John\",\n    sname: \"Smith\",\n    dob: \"1989-03-02\",\n    town: \"Bristol\"\n  },\n  {\n    uid: \"2_l\",\n    fname: \"Tom\",\n    sname: \"Hanks\",\n    dob: \"1956-07-09\",\n    town: \"Concord\"\n  },\n  {\n    uid: \"3_l\",\n    fname: \"David\",\n    sname: \"Smith\",\n    dob: \"1981-08-21\",\n    town: \"London\"\n  }\n]\n)}\n\nfunction _records_r(){return(\n[\n  {\n    uid: \"1_r\",\n    fname: \"Jonathan\",\n    sname: \"Smith\",\n    dob: \"1989-03-02\",\n    town: \"Bristol\"\n  },\n  {\n    uid: \"2_r\",\n    fname: \"David\",\n    sname: \"Smith\",\n    dob: \"1981-08-21\",\n    town: \"Peckham\"\n  }\n]\n)}\n\nfunction _df_r(aq,records_r){return(\naq.from(records_r)\n)}\n\nfunction _splink_settings()\n{\n  return {\n    proportion_of_matches: 1 / 100,\n    comparison_columns: [\n      {\n        num_levels: 3,\n        col_name: \"fname\",\n        u_probabilities: [0.8, 0.2],\n        m_probabilities: [0.2, 0.8],\n        case_expression: (row) => {\n          if (row.fname_l == row.fname_r) {\n            return 1;\n          } else {\n            return 0;\n          }\n        }\n      },\n      {\n        num_levels: 3,\n        col_name: \"sname\",\n        u_probabilities: [0.9, 0.1],\n        m_probabilities: [0.2, 0.8],\n        case_expression: (row) => {\n          if (row.sname_l == row.sname_r) {\n            return 1;\n          } else {\n            return 0;\n          }\n        }\n      },\n      {\n        col_name: \"dob\",\n        u_probabilities: [0.99, 0.01],\n        m_probabilities: [0.2, 0.8],\n        case_expression: (row) => {\n          if (row.dob_l == row.dob_r) {\n            return 1;\n          } else {\n            return 0;\n          }\n        }\n      },\n      {\n        col_name: \"town\",\n        u_probabilities: [0.7, 0.3],\n        m_probabilities: [0.3, 0.7],\n        case_expression: (row) => {\n          if (row.town_l == row.town_r) {\n            return 1;\n          } else {\n            return 0;\n          }\n        }\n      }\n    ]\n  };\n}\n\n\nfunction _df_comparison(get_df_comparison,records_l,records_r){return(\nget_df_comparison(records_l, records_r)\n)}\n\nfunction _7(df_comparison){return(\ndf_comparison.view()\n)}\n\nfunction _df_gammas(get_df_gammas,df_comparison,splink_settings){return(\nget_df_gammas(df_comparison, splink_settings)\n)}\n\nfunction _9(df_gammas){return(\ndf_gammas.view()\n)}\n\nfunction _10(get_df_e,df_gammas,splink_settings,term_freqs){return(\nget_df_e(df_gammas, splink_settings, term_freqs).view()\n)}\n\nfunction _get_df_e(get_match_probability,aq){return(\nfunction get_df_e(df_gammas, splink_settings, term_freqs = {}) {\n  let df_e = df_gammas.objects().map(function (row) {\n    row[\"match_probability\"] = get_match_probability(\n      row,\n      splink_settings,\n      term_freqs\n    );\n    return row;\n  });\n  let df = aq.from(df_e);\n  df = df.relocate([\"match_probability\"], { after: \"uid_r\" });\n  return df;\n}\n)}\n\nfunction _get_match_probability(prob_to_log2_bf,log2_bf_to_prob){return(\nfunction (row, settings, term_freqs = {}) {\n  let comparison_columns = settings.comparison_columns;\n  let prior_log2_bg = prob_to_log2_bf(settings.proportion_of_matches);\n\n  let log2_bayes = comparison_columns.reduce((a, cc) => {\n    let gamma_col_name = \"𝛾_\" + cc.col_name;\n    let gamma = row[gamma_col_name];\n\n    // gamma = -1 means one side of the comparison is null\n    if (gamma == -1) {\n      return a;\n    }\n\n    let m = cc[\"m_probabilities\"][gamma];\n    let u = cc[\"u_probabilities\"][gamma];\n\n    // If TF lookup provided, attempt to use to overwrite u\n    let l_val = row[cc.col_name + \"_l\"].toLowerCase();\n    let r_val = row[cc.col_name + \"_r\"].toLowerCase();\n\n    if (l_val == r_val) {\n      if (cc.col_name in term_freqs) {\n        let tfs = term_freqs[cc.col_name];\n\n        let u_l = tfs[l_val] || 0;\n        let u_r = tfs[r_val] || 0;\n        let u_new = Math.max(u_l, u_r);\n        if (u_new > 0) {\n          u = u_new;\n        }\n      }\n    }\n\n    return a + Math.log2(m / u);\n  }, prior_log2_bg);\n\n  return log2_bf_to_prob(log2_bayes);\n}\n)}\n\nfunction _get_match_probability_components(prob_to_log2_bf,log2_bf_to_prob){return(\nfunction (row, settings, num_columns) {\n  if (num_columns == undefined) {\n    num_columns = settings.comparison_columns.length;\n  }\n  let comparison_columns = settings.comparison_columns.slice(0, num_columns);\n  let prior_log2_bg = prob_to_log2_bf(settings.proportion_of_matches);\n\n  let d = {\n    comparison_vector: [],\n    gamma_symbols: [],\n    m_values: [],\n    u_values: [],\n    m_symbols: [],\n    u_symbols: [],\n\n    bayes_factors: [],\n    log2_bayes_factors: [],\n    col_names: [],\n    match_probability: null,\n    lam: settings.proportion_of_matches\n  };\n\n  comparison_columns.forEach((cc) => {\n    let col_name = \"𝛾_\" + cc.col_name;\n    let gamma = row[col_name];\n    let m = cc[\"m_probabilities\"][gamma];\n    let u = cc[\"u_probabilities\"][gamma];\n    let col_name_escaped = cc.col_name.replace(\"_\", \"\\\\_\");\n\n    d[\"comparison_vector\"].push(gamma);\n    d[\"gamma_symbols\"].push(`\\\\gamma_\\\\text{${col_name_escaped}}`);\n    d[\"col_names\"].push(col_name);\n    d[\"m_values\"].push(m);\n    d[\"m_symbols\"].push(`m_{\\\\text{${col_name_escaped}},${gamma}}`);\n    d[\"u_values\"].push(u);\n    d[\"u_symbols\"].push(`u_{\\\\text{${col_name_escaped}},${gamma}}`);\n    d[\"bayes_factors\"].push(m / u);\n    d[\"log2_bayes_factors\"].push(Math.log2(m / u));\n  });\n\n  let log2_bayes = d[\"log2_bayes_factors\"].reduce((a, bf) => {\n    return a + bf;\n  }, prior_log2_bg);\n\n  d[\"match_probability\"] = log2_bf_to_prob(log2_bayes);\n  let lam = settings.proportion_of_matches;\n  d[\"size_of_match_portion\"] = lam * d[\"m_values\"].reduce((a, b) => a * b, 1);\n  d[\"size_of_non_match_portion\"] =\n    (1 - lam) * d[\"u_values\"].reduce((a, b) => a * b, 1);\n  return d;\n}\n)}\n\nfunction _get_m_u_formula_numbers(get_match_probability_components){return(\nfunction(row, settings, num_columns) {\n  let d = get_match_probability_components(row, settings, num_columns);\n  let m = d[\"m_values\"].map(d => d.toPrecision(3));\n  let u = d[\"u_values\"].map(d => d.toPrecision(3));\n  let lam = d[\"lam\"].toPrecision(3);\n  let lam_m = [lam].concat(m);\n  let lam_u = [`(1 - ${lam})`].concat(u);\n\n  let m_tex = lam_m.join(\" \\\\times \");\n  let u_tex = lam_u.join(\" \\\\times \");\n\n  let p = d[\"match_probability\"].toPrecision(3);\n  let m_part = d[\"size_of_match_portion\"].toPrecision(3);\n  let u_part = d[\"size_of_non_match_portion\"].toPrecision(3);\n  return `\\\\frac{${m_tex}}{(${m_tex}) + (${u_tex})}  \\\\newline\\[10pt] = \\\\frac{${m_part}}{${m_part} + ${u_part}}  \\\\newline\\[10pt] = ${p}`;\n}\n)}\n\nfunction _get_m_u_formula_symbols(get_match_probability_components){return(\nfunction(row, settings) {\n  let d = get_match_probability_components(row, settings);\n  let m = d[\"m_symbols\"];\n  let u = d[\"u_symbols\"];\n  let lam = d[\"lam\"];\n  let lam_m = [\"\\\\lambda\"].concat(m);\n  let lam_u = [`(1 - \\\\lambda)`].concat(u);\n  let m_tex = lam_m.join(\" \");\n  let u_tex = lam_u.join(\" \");\n\n  return `\\\\frac{${m_tex}}{${m_tex}) + ${u_tex}}`;\n}\n)}\n\nfunction _16(tex,get_m_u_formula_symbols,df_gammas,splink_settings){return(\ntex`${get_m_u_formula_symbols(df_gammas.objects()[0], splink_settings)}\n`\n)}\n\nfunction _get_comparison_vector_symbols_and_numbers(get_match_probability_components){return(\nfunction (\n  row,\n  settings,\n  num_columns\n) {\n  let d = get_match_probability_components(row, settings, num_columns);\n  let joined = d[\"gamma_symbols\"].join(\", \");\n  let joined2 = d[\"comparison_vector\"].join(\", \");\n  return `\\\\bm{\\\\gamma} = [${joined}]= [${joined2}]`;\n}\n)}\n\nfunction _18(tex,get_comparison_vector_symbols_and_numbers,df_gammas,splink_settings){return(\ntex`${get_comparison_vector_symbols_and_numbers(\n  df_gammas.objects()[0],\n  splink_settings\n)}\n`\n)}\n\nfunction _19(tex){return(\ntex`\\bm{\\gamma} = [\\gamma_\\text{fname}, \\gamma_\\text{sname}]`\n)}\n\nfunction _20(tex,get_m_u_formula_numbers,df_gammas,splink_settings){return(\ntex`${get_m_u_formula_numbers(df_gammas.objects()[0], splink_settings)}`\n)}\n\nfunction _21(get_match_probability_components,df_gammas,splink_settings)\n{\n  return get_match_probability_components(\n    df_gammas.objects()[0],\n    splink_settings\n  );\n}\n\n\nfunction _get_df_comparison(aq){return(\nfunction (records_as_dict_l, records_as_dict_r) {\n  let df_l = aq.from(records_as_dict_l);\n  let df_r = aq.from(records_as_dict_r);\n  let df_comparison = df_l.join(df_r, (a, b) => true, null, {\n    suffix: [\"_l\", \"_r\"]\n  });\n\n  // Group columns\n  let colname_no_suffix = df_l.columnNames();\n\n  let cols_ordered = [];\n  colname_no_suffix.forEach((d) => {\n    cols_ordered.push(d + \"_l\");\n    cols_ordered.push(d + \"_r\");\n  });\n\n  df_comparison = df_comparison.select(cols_ordered);\n\n  return df_comparison;\n}\n)}\n\nfunction _get_df_gammas(aq){return(\nfunction get_df_gammas(df_comparison, splink_settings) {\n  let comparison_columns = splink_settings[\"comparison_columns\"];\n  // let df_gammas = df_comparison;\n  // let derivation = {};\n  // comparison_columns.forEach(function (cc) {\n  //   derivation[\"𝛾_\" + cc.col_name] = cc.case_expression;\n  // });\n\n  // df_gammas = df_gammas.derive(derivation);\n\n  // Since we want function calls like double metaphone in our comparison columns, we need to\n  // roundtrip from aq -> object -> aq\n\n  let df_gammas = df_comparison.objects();\n\n  comparison_columns.forEach(function (cc) {\n    df_gammas.forEach(function (row) {\n      row[\"𝛾_\" + cc.col_name] = cc.case_expression(row);\n    });\n  });\n\n  df_gammas = aq.from(df_gammas);\n\n  // Put columns in order\n  let col_order = [\"uid_l\", \"uid_r\"];\n  comparison_columns.forEach((cc) => {\n    col_order.push(cc.col_name + \"_l\");\n    col_order.push(cc.col_name + \"_r\");\n    col_order.push(\"𝛾_\" + cc.col_name);\n  });\n\n  df_gammas = df_gammas.select(col_order);\n\n  return df_gammas;\n}\n)}\n\nfunction _bayes_factor_to_prob(){return(\nfunction bayes_factor_to_prob(b) {\n  return b / (b + 1);\n}\n)}\n\nfunction _log2_bf_to_prob(bayes_factor_to_prob){return(\nfunction log2_bf_to_prob(b) {\n  return bayes_factor_to_prob(2 ** b);\n}\n)}\n\nfunction _prob_to_bayes_factor(){return(\nfunction prob_to_bayes_factor(p) {\n  return p / (1 - p);\n}\n)}\n\nfunction _prob_to_log2_bf(prob_to_bayes_factor){return(\nfunction prob_to_log2_bf(p) {\n  return Math.log2(prob_to_bayes_factor(p));\n}\n)}\n\nfunction _first_name_lookup(d3)\n{\n  return d3\n    .csv(\n      \"https://gist.githubusercontent.com/RobinL/0ee2e59db8cbecc105942fe4b101e847/raw/110e5bb3b574b7584b5452d4accfcfad71f2b19d/first_name_noyear.csv\",\n      d3.autoType\n    )\n    .then((csv_file) => {\n      let lookup = {};\n      csv_file.forEach((row) => {\n        lookup[row.firstname] = row.freq;\n      });\n      return lookup;\n    });\n}\n\n\nfunction _surname_lookup(d3)\n{\n  return d3\n    .csv(\n      \"https://gist.githubusercontent.com/RobinL/0ee2e59db8cbecc105942fe4b101e847/raw/110e5bb3b574b7584b5452d4accfcfad71f2b19d/last_name.csv\",\n      d3.autoType\n    )\n    .then((csv_file) => {\n      let lookup = {};\n      csv_file.forEach((row) => {\n        lookup[row.surname] = row.freq;\n      });\n      return lookup;\n    });\n}\n\n\nfunction _term_freqs(first_name_lookup,surname_lookup)\n{\n  return {\n    fname: first_name_lookup,\n    sname: surname_lookup\n  };\n}\n\n\nfunction _32(term_freqs){return(\nterm_freqs.fname[\"joshua\"]\n)}\n\nfunction _33(term_freqs){return(\nterm_freqs.sname[\"linacre\"]\n)}\n\nexport default function define(runtime, observer) {\n  const main = runtime.module();\n  main.variable(observer()).define([\"md\"], _1);\n  main.variable(observer(\"records_l\")).define(\"records_l\", _records_l);\n  main.variable(observer(\"records_r\")).define(\"records_r\", _records_r);\n  main.variable(observer(\"df_r\")).define(\"df_r\", [\"aq\",\"records_r\"], _df_r);\n  main.variable(observer(\"splink_settings\")).define(\"splink_settings\", _splink_settings);\n  main.variable(observer(\"df_comparison\")).define(\"df_comparison\", [\"get_df_comparison\",\"records_l\",\"records_r\"], _df_comparison);\n  main.variable(observer()).define([\"df_comparison\"], _7);\n  main.variable(observer(\"df_gammas\")).define(\"df_gammas\", [\"get_df_gammas\",\"df_comparison\",\"splink_settings\"], _df_gammas);\n  main.variable(observer()).define([\"df_gammas\"], _9);\n  main.variable(observer()).define([\"get_df_e\",\"df_gammas\",\"splink_settings\",\"term_freqs\"], _10);\n  main.variable(observer(\"get_df_e\")).define(\"get_df_e\", [\"get_match_probability\",\"aq\"], _get_df_e);\n  main.variable(observer(\"get_match_probability\")).define(\"get_match_probability\", [\"prob_to_log2_bf\",\"log2_bf_to_prob\"], _get_match_probability);\n  main.variable(observer(\"get_match_probability_components\")).define(\"get_match_probability_components\", [\"prob_to_log2_bf\",\"log2_bf_to_prob\"], _get_match_probability_components);\n  main.variable(observer(\"get_m_u_formula_numbers\")).define(\"get_m_u_formula_numbers\", [\"get_match_probability_components\"], _get_m_u_formula_numbers);\n  main.variable(observer(\"get_m_u_formula_symbols\")).define(\"get_m_u_formula_symbols\", [\"get_match_probability_components\"], _get_m_u_formula_symbols);\n  main.variable(observer()).define([\"tex\",\"get_m_u_formula_symbols\",\"df_gammas\",\"splink_settings\"], _16);\n  main.variable(observer(\"get_comparison_vector_symbols_and_numbers\")).define(\"get_comparison_vector_symbols_and_numbers\", [\"get_match_probability_components\"], _get_comparison_vector_symbols_and_numbers);\n  main.variable(observer()).define([\"tex\",\"get_comparison_vector_symbols_and_numbers\",\"df_gammas\",\"splink_settings\"], _18);\n  main.variable(observer()).define([\"tex\"], _19);\n  main.variable(observer()).define([\"tex\",\"get_m_u_formula_numbers\",\"df_gammas\",\"splink_settings\"], _20);\n  main.variable(observer()).define([\"get_match_probability_components\",\"df_gammas\",\"splink_settings\"], _21);\n  main.variable(observer(\"get_df_comparison\")).define(\"get_df_comparison\", [\"aq\"], _get_df_comparison);\n  main.variable(observer(\"get_df_gammas\")).define(\"get_df_gammas\", [\"aq\"], _get_df_gammas);\n  main.variable(observer(\"bayes_factor_to_prob\")).define(\"bayes_factor_to_prob\", _bayes_factor_to_prob);\n  main.variable(observer(\"log2_bf_to_prob\")).define(\"log2_bf_to_prob\", [\"bayes_factor_to_prob\"], _log2_bf_to_prob);\n  main.variable(observer(\"prob_to_bayes_factor\")).define(\"prob_to_bayes_factor\", _prob_to_bayes_factor);\n  main.variable(observer(\"prob_to_log2_bf\")).define(\"prob_to_log2_bf\", [\"prob_to_bayes_factor\"], _prob_to_log2_bf);\n  const child1 = runtime.module(define1);\n  main.import(\"aq\", child1);\n  main.import(\"op\", child1);\n  main.variable(observer(\"first_name_lookup\")).define(\"first_name_lookup\", [\"d3\"], _first_name_lookup);\n  main.variable(observer(\"surname_lookup\")).define(\"surname_lookup\", [\"d3\"], _surname_lookup);\n  main.variable(observer(\"term_freqs\")).define(\"term_freqs\", [\"first_name_lookup\",\"surname_lookup\"], _term_freqs);\n  main.variable(observer()).define([\"term_freqs\"], _32);\n  main.variable(observer()).define([\"term_freqs\"], _33);\n  return main;\n}\n","import define1 from \"./ef62bc8f8c0d577e@90.js\";\nimport define2 from \"./843cb6e82d7c3d9b@474.js\";\nimport define3 from \"./d25176b0fe784ad0@488.js\";\nimport define4 from \"./79750b3b8e929d9d@209.js\";\n\nfunction _1(md){return(\nmd`# Charts and Figures (Introduction)`\n)}\n\nfunction _example_record_1_l(Record){return(\nnew Record({\n  first_name: \"John\",\n  surname: \"Smith\",\n  date_of_birth: \"1989-03-02\",\n  town: \"Bristol\"\n})\n)}\n\nfunction _example_record_1_r(Record){return(\nnew Record({\n  first_name: \"John\",\n  surname: \"Smith\",\n  date_of_birth: \"1989-03-02\",\n  town: \"Bath\"\n})\n)}\n\nfunction _example_1_comparison(RecordComparison,example_record_1_l,example_record_1_r){return(\nnew RecordComparison(\n  example_record_1_l,\n  example_record_1_r\n)\n)}\n\nfunction _splink_settings()\n{\n  return {\n    proportion_of_matches: 1 / 100,\n    comparison_columns: [\n      {\n        num_levels: 3,\n        col_name: \"first_name\",\n        u_probabilities: [0.8, 0.2],\n        m_probabilities: [0.2, 0.8]\n      },\n      {\n        num_levels: 3,\n        col_name: \"surname\",\n        u_probabilities: [0.9, 0.1],\n        m_probabilities: [0.2, 0.8]\n      },\n      {\n        col_name: \"date_of_birth\",\n        u_probabilities: [0.99, 0.01],\n        m_probabilities: [0.2, 0.8]\n      },\n      {\n        col_name: \"town\",\n        u_probabilities: [0.7, 0.3],\n        m_probabilities: [0.3, 0.7]\n      }\n    ]\n  };\n}\n\n\nfunction _example_1_row_with_gammas(example_1_comparison,example_record_1_l)\n{\n  let row = example_1_comparison.as_wide().objects()[0];\n\n  Object.keys(example_record_1_l.as_dict()).forEach((k) => {\n    if (row[k + \"_l\"] == row[k + \"_r\"]) {\n      row[\"𝛾_\" + k] = 1;\n    } else {\n      row[\"𝛾_\" + k] = 0;\n    }\n  });\n  return row;\n}\n\n\nfunction _overrides()\n{\n  return {\n    title: {\n      text:\n        \"Match weights and their cumulative contribution to match probability\",\n      subtitle: \"\"\n    },\n    height: 200\n  };\n}\n\n\nfunction _intro_simple_waterfall(get_waterfall_chart,example_1_row_with_gammas,splink_settings,overrides){return(\nget_waterfall_chart(\n  example_1_row_with_gammas,\n  splink_settings,\n  overrides,\n  true\n)\n)}\n\nfunction _11(md){return(\nmd`# Charts and Figures (Mathematical Model)`\n)}\n\nfunction _parseTableData(){return(\nfunction parseTableData(table) {\n  const data = [];\n\n  const replace_lookup = {\n    \"unique id\": \"uid\",\n    \"first name\": \"fname\",\n    surname: \"sname\",\n    \"date of birth\": \"dob\",\n    town: \"town\"\n  };\n\n  table.querySelectorAll(\"tr\").forEach((row, i) => {\n    let cells = row.cells;\n    let row_data = [];\n\n    for (let cell of cells) {\n      let value = cell.innerText;\n      value = value.trim();\n      value = value.toLowerCase();\n      if (value == \"\") {\n        value = null;\n      }\n      row_data.push(value);\n    }\n    data.push(row_data);\n  });\n\n  const formattedData = data.reduce((accumulator, row, i) => {\n    if (i == 0) {\n      row = row.map((d) => replace_lookup[d]);\n      accumulator.properties = row;\n    } else {\n      const rowObject = {};\n\n      accumulator.properties.forEach((key, i) => {\n        rowObject[key] = row[i];\n      });\n      accumulator.push(rowObject);\n    }\n    return accumulator;\n  }, []);\n  return formattedData;\n}\n)}\n\nfunction _records_l(Generators,parseTableData,table_l){return(\nGenerators.observe((notify) => {\n  const keyinput = (event) => notify(parseTableData(table_l));\n  table_l.addEventListener(\"input\", keyinput, false);\n  notify(parseTableData(table_l));\n  return () => window.removeEventListener(\"input\", keyinput);\n})\n)}\n\nfunction _table_l(html){return(\nhtml`\n<table id=\"data-table\" >\n\n<tr>\n\n<th>Unique ID</th>\n<th>First name</th>\n<th>Surname</th>\n<th>Date of Birth</th>\n<th>Town</th>\n\n</tr>\n\n<tr>\n<td>1_l</td>\n<td contenteditable>John</td>\n\n<td contenteditable>Smith</td>\n<td contenteditable>1989-03-02</td>\n<td contenteditable>Bristol</td>\n\n</tr>\n\n\n<tr>\n<td>2_l</td>\n<td contenteditable>Emma</td>\n\n<td contenteditable>Jones</td>\n<td contenteditable>1956-07-09</td>\n<td contenteditable>Hull</td>\n\n</tr>\n\n\n<tr>\n<td>3_l</td>\n<td contenteditable>David</td>\n\n<td contenteditable>Smith</td>\n<td contenteditable>1981-08-21</td>\n<td contenteditable>London</td>\n\n</tr>\n\n\n</table>\n`\n)}\n\nfunction _table_r(html){return(\nhtml`\n<table id=\"data-table\" >\n\n<tr>\n\n<th>Unique ID</th>\n<th>First name</th>\n<th>Surname</th>\n<th>Date of Birth</th>\n<th>Town</th>\n\n</tr>\n\n<tr>\n<td>1_r</td>\n<td contenteditable>Jonathan</td>\n\n<td contenteditable>Smith</td>\n<td contenteditable>1989-03-02</td>\n<td contenteditable>Bristol</td>\n\n</tr>\n\n\n<tr>\n<td>2_r</td>\n<td contenteditable>David</td>\n\n<td contenteditable>Smith</td>\n<td contenteditable>1981-08-21</td>\n<td contenteditable>Peckham</td>\n\n</tr>\n\n\n\n</table>\n`\n)}\n\nfunction _records_r(Generators,parseTableData,table_r){return(\nGenerators.observe((notify) => {\n  const keyinput = (event) => notify(parseTableData(table_r));\n  table_r.addEventListener(\"input\", keyinput, false);\n  notify(parseTableData(table_r));\n  return () => window.removeEventListener(\"input\", keyinput);\n})\n)}\n\nfunction _df_1_l(aq,records_l){return(\naq.from(records_l)\n)}\n\nfunction _df_1_r(aq,records_r){return(\naq.from(records_r)\n)}\n\nfunction _df_comparisons_1(get_df_comparison,records_l,records_r){return(\nget_df_comparison(records_l, records_r)\n)}\n\nfunction _df_gammas_1(get_df_gammas,df_comparisons_1,splink_settings_1){return(\nget_df_gammas(df_comparisons_1, splink_settings_1)\n)}\n\nfunction _df_gammas_only_1(df_gammas_1)\n{\n  let uids = [\"uid_l\", \"uid_r\"];\n  let colnames = df_gammas_1.columnNames();\n  colnames = colnames.filter((d) => d.includes(\"𝛾_\"));\n  colnames = uids.concat(colnames);\n  return df_gammas_1.select(colnames);\n}\n\n\nfunction _splink_settings_1()\n{\n  return {\n    proportion_of_matches: 1 / 100,\n    comparison_columns: [\n      {\n        num_levels: 3,\n        col_name: \"fname\",\n        u_probabilities: [0.8, 0.2],\n        m_probabilities: [0.2, 0.8],\n        case_expression: (row) => {\n          if (row.fname_l == row.fname_r) {\n            return 1;\n          } else {\n            return 0;\n          }\n        }\n      },\n      {\n        num_levels: 3,\n        col_name: \"sname\",\n        u_probabilities: [0.9, 0.1],\n        m_probabilities: [0.2, 0.8],\n        case_expression: (row) => {\n          if (row.sname_l == row.sname_r) {\n            return 1;\n          } else {\n            return 0;\n          }\n        }\n      },\n      {\n        col_name: \"dob\",\n        u_probabilities: [0.99, 0.01],\n        m_probabilities: [0.2, 0.8],\n        case_expression: (row) => {\n          if (row.dob_l == row.dob_r) {\n            return 1;\n          } else {\n            return 0;\n          }\n        }\n      },\n      {\n        col_name: \"town\",\n        u_probabilities: [0.7, 0.3],\n        m_probabilities: [0.3, 0.7],\n        case_expression: (row) => {\n          if (row.town_l == row.town_r) {\n            return 1;\n          } else {\n            return 0;\n          }\n        }\n      }\n    ]\n  };\n}\n\n\nfunction _example_record_2_l(Record){return(\nnew Record({\n  first_name: \"Tom\",\n  surname: \"Hanks\",\n  month_of_birth: \"July\"\n})\n)}\n\nfunction _example_record_2_r(Record){return(\nnew Record({\n  first_name: \"Tom\",\n  surname: \"Hanks\",\n  month_of_birth: \"June\"\n})\n)}\n\nfunction _example_2_comparison(RecordComparison,example_record_2_l,example_record_2_r){return(\nnew RecordComparison(\n  example_record_2_l,\n  example_record_2_r\n)\n)}\n\nexport default function define(runtime, observer) {\n  const main = runtime.module();\n  main.variable(observer()).define([\"md\"], _1);\n  const child1 = runtime.module(define1);\n  main.import(\"Record\", child1);\n  main.import(\"RecordComparison\", child1);\n  const child2 = runtime.module(define2);\n  main.import(\"get_waterfall_chart\", child2);\n  main.variable(observer(\"example_record_1_l\")).define(\"example_record_1_l\", [\"Record\"], _example_record_1_l);\n  main.variable(observer(\"example_record_1_r\")).define(\"example_record_1_r\", [\"Record\"], _example_record_1_r);\n  main.variable(observer(\"example_1_comparison\")).define(\"example_1_comparison\", [\"RecordComparison\",\"example_record_1_l\",\"example_record_1_r\"], _example_1_comparison);\n  main.variable(observer(\"splink_settings\")).define(\"splink_settings\", _splink_settings);\n  main.variable(observer(\"example_1_row_with_gammas\")).define(\"example_1_row_with_gammas\", [\"example_1_comparison\",\"example_record_1_l\"], _example_1_row_with_gammas);\n  main.variable(observer(\"overrides\")).define(\"overrides\", _overrides);\n  main.variable(observer(\"intro_simple_waterfall\")).define(\"intro_simple_waterfall\", [\"get_waterfall_chart\",\"example_1_row_with_gammas\",\"splink_settings\",\"overrides\"], _intro_simple_waterfall);\n  main.variable(observer()).define([\"md\"], _11);\n  const child3 = runtime.module(define3);\n  main.import(\"get_df_comparison\", child3);\n  main.import(\"get_df_gammas\", child3);\n  main.variable(observer(\"parseTableData\")).define(\"parseTableData\", _parseTableData);\n  main.variable(observer(\"records_l\")).define(\"records_l\", [\"Generators\",\"parseTableData\",\"table_l\"], _records_l);\n  main.variable(observer(\"table_l\")).define(\"table_l\", [\"html\"], _table_l);\n  main.variable(observer(\"table_r\")).define(\"table_r\", [\"html\"], _table_r);\n  main.variable(observer(\"records_r\")).define(\"records_r\", [\"Generators\",\"parseTableData\",\"table_r\"], _records_r);\n  main.variable(observer(\"df_1_l\")).define(\"df_1_l\", [\"aq\",\"records_l\"], _df_1_l);\n  main.variable(observer(\"df_1_r\")).define(\"df_1_r\", [\"aq\",\"records_r\"], _df_1_r);\n  main.variable(observer(\"df_comparisons_1\")).define(\"df_comparisons_1\", [\"get_df_comparison\",\"records_l\",\"records_r\"], _df_comparisons_1);\n  main.variable(observer(\"df_gammas_1\")).define(\"df_gammas_1\", [\"get_df_gammas\",\"df_comparisons_1\",\"splink_settings_1\"], _df_gammas_1);\n  main.variable(observer(\"df_gammas_only_1\")).define(\"df_gammas_only_1\", [\"df_gammas_1\"], _df_gammas_only_1);\n  main.variable(observer(\"splink_settings_1\")).define(\"splink_settings_1\", _splink_settings_1);\n  main.variable(observer(\"example_record_2_l\")).define(\"example_record_2_l\", [\"Record\"], _example_record_2_l);\n  main.variable(observer(\"example_record_2_r\")).define(\"example_record_2_r\", [\"Record\"], _example_record_2_r);\n  main.variable(observer(\"example_2_comparison\")).define(\"example_2_comparison\", [\"RecordComparison\",\"example_record_2_l\",\"example_record_2_r\"], _example_2_comparison);\n  const child4 = runtime.module(define4);\n  main.import(\"aq\", child4);\n  main.import(\"op\", child4);\n  return main;\n}\n","import define1 from \"./ea6530af059f37be@231.js\";\nimport define2 from \"./d25176b0fe784ad0@488.js\";\n\nfunction _title(md){return(\nmd`# The mathematics of the Fellegi Sunter model`\n)}\n\nfunction _2(md){return(\nmd`*A final version of this notebook can be viewed on my blog [here](https://www.robinlinacre.com/maths_of_fellegi_sunter/).*`\n)}\n\nfunction _para_1(md){return(\nmd`In this article, we present an implementation of [Fellegi and Sunter's model of probabilistic record linkage](https://courses.cs.washington.edu/courses/cse590q/04au/papers/Felligi69.pdf) (1969).  \n\nWe build up a simple Fellegi Sunter (FS) model piece by piece, demonstrating how it can be used to compute match probabilities. In this article, we assume parameters of the model are known. \n\nA more technical treatment is given in [AP\tEnamorado, T., Fifield, B., & Imai, K. (2019)](https://imai.fas.harvard.edu/research/files/linkage.pdf), which contains a generalised form of the model.`\n)}\n\nfunction _para_2(md){return(\nmd`## Objective of the Model\n\nThe input to the FS model is a dataset of pairwise record comparisons.\n\nThe aim of the model is to estimate a 'match probability' for each pairwsie comparison, which quantifies the likelihood the two records  represent the same entity.`\n)}\n\nfunction _para_3(md){return(\nmd`## Set up\n\nThe FS model can be used to link and/or deduplicate one or more datasests. In what follows, let's assume we have two datasets we wish to link:\n\n✨<span style=\"background-color:yellow\">You can edit the records in the tables, and all of the subsequent calculations will update accordingly.</span>✨\n\n### Dataset 1\n\n`\n)}\n\nfunction _table_l1(table_l){return(\ntable_l\n)}\n\nfunction _ds2_head(md){return(\nmd`### Dataset 2`\n)}\n\nfunction _table_r1(table_r){return(\ntable_r\n)}\n\nfunction _rec_comparisons(md,df_comparisons_1){return(\nmd`\n\nTo be compatible with the FS model, the input data must be converted into pairwise comparisons as follows:\n\n### Record comparisons\n\n${df_comparisons_1.view()}\n<br>\nThis table compares every row in dataset 1 to every row in dataset 2.  \n`\n)}\n\nfunction _para_4(md,df_gammas_1,df_gammas_only_1,texd,get_comparison_vector_symbols_and_numbers,settings){return(\nmd`## Comparing columns\n\nWe need a mathematical way of evaluating these pairwise comparisons - a function that takes the comparisons as an input, and outputs match probabilities.  \n\nThe FS model solves this problem by comparing the records column by column, and assigning each comparison to two or more 'similarity levels'.\n\nA simple example of a two-level comparison rule for a column may be:\n\n- If the values in the column exactly match, assign the comparison to similarity level 1\n- Otherwise assign the comparison to similarity level 0\n\nIn the following table, we apply this simple rule to every column. The comparisons are denoted with the prefix \\`𝛾_\\` because the mathematical symbol gamma is often used in the literate to represent comparisons.\n\n${df_gammas_1.view()}\n\n<br>\n\nNow that we have a numeric representation of the comparisons, the model makes no further use of the raw data, instead using only the values in the 𝛾 columns: \n\n${df_gammas_only_1.view()}   \n<br>\nFor each row in this table, the set of gamma values is known as the 'comparison vector'.  For example, the comparison vector for the first row in the table is:\n\n${texd`${get_comparison_vector_symbols_and_numbers(\n  df_gammas_1.slice(1 - 1, 1).objects()[0],\n  settings\n)}`}\n `\n)}\n\nfunction _subhead_1(md){return(\nmd`## Scoring comparisons`\n)}\n\nfunction _para_5(md){return(\nmd`We now need a way of recombining these individual column comparisons into an overall match probability.  \n\nWe will want this approach to account for the differing importance of columns.  For example, a match on gender is less informative than a match on date of birth.\n\nThe FS model approaches this problem by estimating match weights for each individual column and combining these match weights.  \n\nBy assuming mutual independence of the features, each column can be accounted for separately, dramatically simplifying the maths.  \n\nIn particular, this assumption makes the model equivalent to a [Naïve Bayes](https://en.wikipedia.org/wiki/Naive_Bayes_classifier) classifier.  This allows the match probability to be expressed as a repeated multiplication of conditional probabilities. Further mathmetical details can be found [here](https://en.wikipedia.org/wiki/Naive_Bayes_classifier#Probabilistic_model).\n\nIn our case, 'mutual independence of features' means that linkage variables must be independent given the match status.  \n\nThis would be violated if amongst matching records, a typo on first name was correlated with a typo on surname.  Another  violation often occurs with addresses if they are separated into multiple columns: Amongst matching records, a match on postcode typically implies a match on town.  \n\nTo further understand how we account for each comparison column in the computation of match probability, we need to introduce the concept of \\`m\\` and \\`u\\` probabilities.\n`\n)}\n\nfunction _para_6(md,texd){return(\nmd`### m and u probabilities \n\nHow much should we increase our estimate of match probability if we observe a match on first name? How about a match on gender? And what about if we observe a mismatch on these fields?  \n\nWe are interested in evaluating statements like: \n\n${texd`\\operatorname{Pr}(\\text{records match}|\\text{first name matches})`} \n\nThis can be quantified using the m and u probabilities for each column, combined with Bayes Theorem (see annex for a refresher).\n\nConsider the first name column.  We have defined two similarity levels:  level 1 if the first name exactly matches, and level 0 otherwise.\n\n#### m probabilities\nThe m probabilities for the first name column are:\n\n${texd`m_\\text{first name,level\\_0} = \\operatorname{Pr}(\\text{first name does not match}|\\text{record match})`}\n\n\n${texd`m_\\text{first name, level\\_1} = \\operatorname{Pr}(\\text{first name matches}|\\text{records match})`}\n\n\nThat is, amongst record comparisons which are true matches, what proportion have a match on first name, and what proportion mismatch on first name?\n\nThis is a measure of how often mispellings, nicknames or aliases occur in the first name field.\n\n#### u probabilities\n\nThe u probabilities for the first name column are:\n\n${texd`u_\\text{first name, level\\_0} = \\operatorname{Pr}(\\text{first name does not match}|\\text{records do not match})`}\n\n\n${texd`u_\\text{first name, level\\_1} = \\operatorname{Pr}(\\text{first name matches}|\\text{records do not match})`}\n\n\n\nThat is, amongst record comparisons which are true non-matches, what proportion have a match on first name, and what proportion mismatch on first name?\n\nThis is a measure of how likely 'collisions' are likely to occur. For instance, it would be common for two different people to have the same gender, but less likely for two different people to have the same date of birth.\n\n#### The overall proportion of matches\n\nLet us also define:\n\n${texd`\\operatorname{Pr}(\\text{records match}) = \\lambda`} \n\nThis is our prior - our estimate for the probability that a randomly-chosen pairwise record comparison is a match.\n\n### Bayes Theorem\n\nWe can now use Bayes Theorem  to write:\n\n${texd`\n\\text{posterior} = \\operatorname{Pr}(\\text{records match}|\\text{first name matches}) \\newline [10pt] = \\frac{\\operatorname{Pr}(\\text{first name matches}|\\text{records match})\\operatorname{Pr}(\\text{records match})}{\\operatorname{Pr}{(\\text{first name matches})}}`}\n\nwhich, in our notation is:\n\n${texd`\n\\text{posterior} = \\operatorname{Pr}(\\text{records match}|\\text{first name matches}) \\newline [10pt] = \\frac{m_\\text{first name, level\\_1}\\lambda}{m_\\text{first name, level\\_1}\\lambda + u_\\text{first name, level\\_1}(1-\\lambda)}`}\n\n\n`\n)}\n\nfunction _para_7(md,tex,texd){return(\nmd`We can generalise this formula by using  ${tex`\\gamma`} to indicate the value of the comparison, the index ${tex`k`} to designate the comparison column, and ${tex`\\ell`} to designate the observed comparison level, we can write:\n\n${texd`\n\\text{posterior} = \\operatorname{Pr}(\\text{records match}|\\gamma_{k}) \\newline [10pt] = \\frac{\\lambda m_{k\\ell}}{\\lambda m_{k\\ell}+ u_{k\\ell}(1-\\lambda)}`}\n\nFinally, by assuming conditional independence among linkage variables given the match status, we can account for more than one comparison column.  For instance, in the case of two comparison columns\n\n${texd`\n\\operatorname{Pr}(\\text{records match}|\\gamma_{1},\\gamma_{2}) \\newline [10pt] = \\frac{\\operatorname{Pr}(\\gamma_{1}|\\text{records match})\\operatorname{Pr}(\\gamma_{2}|\\text{records match})\\operatorname{Pr}(\\text{records match})}{\\operatorname{Pr}{(\\gamma_{1},\\gamma_{2})}}`}\n\nLeading to the following formula that takes into account all column comparisons:\n\n#### Equation 1:\n${texd`\n\\operatorname{Pr}(\\text{records match}|\\gamma_{1},\\gamma_{2},\\ldots,\\gamma_{K})  \\newline [10pt] = \\frac{\\lambda m_{1\\ell}m_{2\\ell}\\ldots m_{K\\ell}}{\\lambda m_{1\\ell}m_{2\\ell}\\ldots m_{K\\ell}+ (1-\\lambda)u_{1\\ell}u_{1\\ell} \\ldots u_{K\\ell}} `}\n\n\nThis equation provides the output of the Fellegi Sunter model - an estimate of the probability that two records match given the information contained\n\n`\n)}\n\nfunction _para_8(md){return(\nmd`In subsequent articles, we use the concepts of m and u probabilities to discuss the intuition behind match weights, and present graphical ways of interpreting the values.  \n\nWe finish this article with a worked example of the probability calculation.`\n)}\n\nfunction _subhead_2(md){return(\nmd`## Example`\n)}\n\nfunction _para_10(md){return(\nmd`\nIn order to present an example calculation we need to choose values for the parameters of the model - the m and u values.\n\nWe can represent the m and u values for a comparison column succinctly as follows:\n\n\\`\\`\\`\n{\n  \"col_name\": \"fname\",\n  \"m_probabilities\": [0.2,0.8],\n  \"u_probabilities\": [0.9,0.1],\n}\n\\`\\`\\`\n\nThe position (index) of the arrays corresponds to the comparison level.  \n\nFor example, \\`\"m_probabilities\": [0.2,0.8]\\` means that amongst matching records, 20% have a disagreement on the first name (e.g. \"John\" vs. \"Jonathan\"), and 80% match (e.g. \"David\" vs. \"David\")\n\nUsing this notation, parameters we will choose for our model are as follows.  ✨<span style=\"background-color:yellow\">You may edit these values to see how they affect the calculation.</span>✨\n\n`\n)}\n\nfunction _splink_settings(inputs,default_splink_settings){return(\ninputs.textarea({\n  value: default_splink_settings,\n  rows: 26,\n  spellcheck: false\n})\n)}\n\nfunction _para_11(md){return(\nmd`We will now present a worked example of the calculation of match probability for the following pairwise record comparison.  \n\n\n✨<span style=\"background-color:yellow\">You may change the record comparison using the control below</span>✨\n`\n)}\n\nfunction _row_index(inputs,df_gammas_1){return(\ninputs.range([1, df_gammas_1.numRows()], {\n  value: 1,\n  label: \"Choose record comparison\",\n  step: 1\n})\n)}\n\nfunction _this_row(md,df_comparisons_1,row_index){return(\nmd`${df_comparisons_1.slice(row_index - 1, row_index).toMarkdown()}`\n)}\n\nfunction _para_12(md,texd,get_comparison_vector_symbols_and_numbers,df_gammas_1,row_index,settings){return(\nmd`The comparison vector is given by:\n\n${texd`${get_comparison_vector_symbols_and_numbers(\n  df_gammas_1.slice(row_index - 1, row_index).objects()[0],\n  settings\n)}`}\n\n`\n)}\n\nfunction _para_13(md){return(\nmd`The formula for match probability is:`\n)}\n\nfunction _para_14(texd,get_m_u_formula_symbols,df_gammas_1,row_index,settings){return(\ntexd`${get_m_u_formula_symbols(\n  df_gammas_1.slice(row_index - 1, row_index).objects()[0],\n  settings\n)}`\n)}\n\nfunction _para_15(md){return(\nmd`And substituting in numbers using our specified parameters we get: `\n)}\n\nfunction _para_16(texd,get_m_u_formula_numbers,df_gammas_1,row_index,settings){return(\ntexd`${get_m_u_formula_numbers(\n  df_gammas_1.slice(row_index - 1, row_index).objects()[0],\n  settings\n)}`\n)}\n\nfunction _para_17(md,tex,get_match_probability_components,df_gammas_1,row_index,settings){return(\nmd`i.e. the ${tex`\\text{estimated match probability} = \n\n${get_match_probability_components(\n  df_gammas_1.slice(row_index - 1, row_index).objects()[0],\n  settings\n)[\"match_probability\"].toPrecision(4)}\n\n`}\n\n`\n)}\n\nfunction _para_18(md){return(\nmd`<br><br>`\n)}\n\nfunction _para_19(md,texd,tex){return(\nmd`## Annex:  Bayes Theorem\n\nRecall that Bayes Theorem is given by:\n\n${texd`\n\\operatorname{Pr}(a|b) = {\\frac{\\operatorname{Pr}(b|a)\\operatorname{Pr}(a)}{\\operatorname{Pr}{(b)}}}`} \n\n\nor , in words: \n\n${texd`\n\\text{posterior} = \\frac{\\text{likelihood} \\times \\text{prior}}{\\text{evidence}}`}\n\nIn the context of record linkage, we can describe these parts as:\n\n**Prior**:\nThe overall proportion of comparisons which are matches ${tex`\\operatorname{Pr}(\\text{match})`}.\n\n**Evidence**: We have observed that e.g. first name matches, ${tex`\\operatorname{Pr}(\\text{first name matches})`}.\n\n**Likelihood**: The probability that first name matches amongst matches, given by ${tex`\\operatorname{Pr}(\\text{first name matches}|\\text{records match})`}.  \n\nSo Bayes' formuls is:\n\n${texd`\n\\operatorname{Pr}(\\text{match}|\\text{first name matches}) = \\frac{\\operatorname{Pr}(\\text{first name matches}|\\text{match})\\operatorname{Pr}(\\text{match})}{\\operatorname{Pr}{(\\text{first name matches})}}`}\n\nWhich can also be written:\n\n${texd` \n\\frac{\\operatorname{Pr}(\\text{first name matches}|\\text{match})\\operatorname{Pr}(\\text{match})}{\\operatorname{Pr}(\\text{first name matches}|\\text{match})\\operatorname{Pr}(\\text{match}) + \\operatorname{Pr}(\\text{first name matches}|\\text{non match})\\operatorname{Pr}(\\text{non match})}`}\n\ngiving us:\n\n${texd`\n\\operatorname{Pr}(\\text{match}|\\text{first name matches}) = \n\\frac{m_1\\lambda}{m_1\\lambda + u_1(1-\\lambda)}`}\n\nWhich is the same as Equation 1.\n`\n)}\n\nfunction _30(md){return(\nmd`## Calculations and code`\n)}\n\nfunction _texd(tex){return(\ntex.options({\n  displayMode: true,\n  fleqn: true\n})\n)}\n\nfunction _default_splink_settings()\n{\n  return `{\n    \"proportion_of_matches\": 0.01,\n    \"comparison_columns\": [\n      {\n        \"col_name\": \"fname\",\n        \"u_probabilities\": [0.8, 0.2],\n        \"m_probabilities\": [0.2, 0.8]\n      },\n      {\n        \"col_name\": \"sname\",\n        \"u_probabilities\": [0.9, 0.1],\n        \"m_probabilities\": [0.2, 0.8]\n      },\n      {\n        \"col_name\": \"dob\",\n        \"u_probabilities\": [0.99, 0.01],\n        \"m_probabilities\": [0.2, 0.8]\n      },\n      {\n        \"col_name\": \"town\",\n        \"u_probabilities\": [0.7, 0.3],\n        \"m_probabilities\": [0.3, 0.7]\n      }\n    ]\n  \n  }`;\n}\n\n\nfunction _settings(splink_settings){return(\nJSON.parse(splink_settings)\n)}\n\nfunction _css_styles(html){return(\nhtml`<style>\n.katex-display>.katex { font-size: 1em}\n.katex-display>.katex>.katex-html>.tag {right: unset; padding-left:4em}\ntextarea {\n    max-height: 1000em !important;\n    font-family: monospace !important;\n}\n</style>`\n)}\n\nfunction _inputs(require){return(\nrequire(\"@observablehq/inputs\")\n)}\n\nexport default function define(runtime, observer) {\n  const main = runtime.module();\n  main.variable(observer(\"title\")).define(\"title\", [\"md\"], _title);\n  main.variable(observer()).define([\"md\"], _2);\n  main.variable(observer(\"para_1\")).define(\"para_1\", [\"md\"], _para_1);\n  main.variable(observer(\"para_2\")).define(\"para_2\", [\"md\"], _para_2);\n  main.variable(observer(\"para_3\")).define(\"para_3\", [\"md\"], _para_3);\n  main.variable(observer(\"table_l1\")).define(\"table_l1\", [\"table_l\"], _table_l1);\n  main.variable(observer(\"ds2_head\")).define(\"ds2_head\", [\"md\"], _ds2_head);\n  main.variable(observer(\"table_r1\")).define(\"table_r1\", [\"table_r\"], _table_r1);\n  main.variable(observer(\"rec_comparisons\")).define(\"rec_comparisons\", [\"md\",\"df_comparisons_1\"], _rec_comparisons);\n  main.variable(observer(\"para_4\")).define(\"para_4\", [\"md\",\"df_gammas_1\",\"df_gammas_only_1\",\"texd\",\"get_comparison_vector_symbols_and_numbers\",\"settings\"], _para_4);\n  main.variable(observer(\"subhead_1\")).define(\"subhead_1\", [\"md\"], _subhead_1);\n  main.variable(observer(\"para_5\")).define(\"para_5\", [\"md\"], _para_5);\n  main.variable(observer(\"para_6\")).define(\"para_6\", [\"md\",\"texd\"], _para_6);\n  main.variable(observer(\"para_7\")).define(\"para_7\", [\"md\",\"tex\",\"texd\"], _para_7);\n  main.variable(observer(\"para_8\")).define(\"para_8\", [\"md\"], _para_8);\n  main.variable(observer(\"subhead_2\")).define(\"subhead_2\", [\"md\"], _subhead_2);\n  main.variable(observer(\"para_10\")).define(\"para_10\", [\"md\"], _para_10);\n  main.variable(observer(\"viewof splink_settings\")).define(\"viewof splink_settings\", [\"inputs\",\"default_splink_settings\"], _splink_settings);\n  main.variable(observer(\"splink_settings\")).define(\"splink_settings\", [\"Generators\", \"viewof splink_settings\"], (G, _) => G.input(_));\n  main.variable(observer(\"para_11\")).define(\"para_11\", [\"md\"], _para_11);\n  main.variable(observer(\"viewof row_index\")).define(\"viewof row_index\", [\"inputs\",\"df_gammas_1\"], _row_index);\n  main.variable(observer(\"row_index\")).define(\"row_index\", [\"Generators\", \"viewof row_index\"], (G, _) => G.input(_));\n  main.variable(observer(\"this_row\")).define(\"this_row\", [\"md\",\"df_comparisons_1\",\"row_index\"], _this_row);\n  main.variable(observer(\"para_12\")).define(\"para_12\", [\"md\",\"texd\",\"get_comparison_vector_symbols_and_numbers\",\"df_gammas_1\",\"row_index\",\"settings\"], _para_12);\n  main.variable(observer(\"para_13\")).define(\"para_13\", [\"md\"], _para_13);\n  main.variable(observer(\"para_14\")).define(\"para_14\", [\"texd\",\"get_m_u_formula_symbols\",\"df_gammas_1\",\"row_index\",\"settings\"], _para_14);\n  main.variable(observer(\"para_15\")).define(\"para_15\", [\"md\"], _para_15);\n  main.variable(observer(\"para_16\")).define(\"para_16\", [\"texd\",\"get_m_u_formula_numbers\",\"df_gammas_1\",\"row_index\",\"settings\"], _para_16);\n  main.variable(observer(\"para_17\")).define(\"para_17\", [\"md\",\"tex\",\"get_match_probability_components\",\"df_gammas_1\",\"row_index\",\"settings\"], _para_17);\n  main.variable(observer(\"para_18\")).define(\"para_18\", [\"md\"], _para_18);\n  main.variable(observer(\"para_19\")).define(\"para_19\", [\"md\",\"texd\",\"tex\"], _para_19);\n  main.variable(observer()).define([\"md\"], _30);\n  const child1 = runtime.module(define1);\n  main.import(\"example_2_comparison\", child1);\n  main.import(\"intro_simple_waterfall\", child1);\n  main.import(\"table_l\", child1);\n  main.import(\"table_r\", child1);\n  main.import(\"df_1_l\", child1);\n  main.import(\"df_1_r\", child1);\n  main.import(\"df_comparisons_1\", child1);\n  main.import(\"df_gammas_1\", child1);\n  main.import(\"df_gammas_only_1\", child1);\n  const child2 = runtime.module(define2);\n  main.import(\"get_m_u_formula_symbols\", child2);\n  main.import(\"get_m_u_formula_numbers\", child2);\n  main.import(\"get_comparison_vector_symbols_and_numbers\", child2);\n  main.import(\"get_match_probability_components\", child2);\n  main.variable(observer(\"texd\")).define(\"texd\", [\"tex\"], _texd);\n  main.variable(observer(\"default_splink_settings\")).define(\"default_splink_settings\", _default_splink_settings);\n  main.variable(observer(\"settings\")).define(\"settings\", [\"splink_settings\"], _settings);\n  main.variable(observer(\"css_styles\")).define(\"css_styles\", [\"html\"], _css_styles);\n  main.variable(observer(\"inputs\")).define(\"inputs\", [\"require\"], _inputs);\n  return main;\n}\n","/*@jsxRuntime classic @jsx React.createElement @jsxFrag React.Fragment*/\nimport {useMDXComponents as _provideComponents} from \"@mdx-js/react\";\nimport React from \"react\";\nimport {ProbLinkageLayout as MDXLayout} from \"../components/ProbLinkageLayout\";\nimport {SEO} from \"../components/SEO\";\nexport const Head = props => React.createElement(SEO, {\n  frontmatter: props.pageContext.frontmatter\n});\nimport notebook from '@robinl/86fc30325e4106c4';\nimport ObservableNotebook from '../components/ObservableNotebook';\nimport TutorialNav from '../components/TutorialNav';\nimport CompactTutorialNav from '../components/CompactTutorialNav';\nexport const output_order = [\"para_1\", \"para_2\", \"para_3\", \"table_l1\", \"ds2_head\", \"table_r1\", \"rec_comparisons\", \"para_4\", \"subhead_1\", \"para_5\", \"para_6\", \"para_7\", \"para_8\", \"subhead_2\", \"para_10\", \"viewof splink_settings\", \"para_11\", \"viewof row_index\", \"this_row\", \"para_12\", \"para_13\", \"para_14\", \"para_15\", \"para_16\", \"para_17\", \"para_18\", \"para_19\", \"css_styles\"];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    h1: \"h1\"\n  }, _provideComponents(), props.components);\n  return React.createElement(React.Fragment, null, React.createElement(_components.h1, null, \"Maths of Fellegi Sunter model (old version)\"), \"\\n\", React.createElement(ObservableNotebook, {\n    notebook: notebook,\n    cells: output_order\n  }));\n}\nfunction MDXContent(props = {}) {\n  return React.createElement(MDXLayout, props, React.createElement(_createMdxContent, props));\n}\nexport default MDXContent;\n","import React from 'react';\nimport { Link, useStaticQuery, graphql } from 'gatsby';\n\nconst CompactTutorialNav = ({ frontmatter }) => {\n    const { tutorial_number } = frontmatter;\n\n    const data = useStaticQuery(graphql`\n        query {\n            allMdx(filter: { frontmatter: { tutorial_number: { ne: null } } }) {\n                edges {\n                    node {\n                        frontmatter {\n                            tutorial_number\n                        }\n                        fields {\n                            slug\n                        }\n                    }\n                }\n            }\n        }\n    `);\n\n    const tutorials = data.allMdx.edges.map(\n        edge => edge.node.frontmatter.tutorial_number\n    );\n    const prevExists = tutorials.includes(tutorial_number - 1);\n    const nextExists = tutorials.includes(tutorial_number + 1);\n\n    const prevSlug = data.allMdx.edges.find(\n        edge => edge.node.frontmatter.tutorial_number === tutorial_number - 1\n    )?.node?.fields?.slug;\n    const nextSlug = data.allMdx.edges.find(\n        edge => edge.node.frontmatter.tutorial_number === tutorial_number + 1\n    )?.node?.fields?.slug;\n\n    return (\n        <div className=\"bg-gray-100 p-2 mt-2 mb-2 italic rounded-md text-gray-600 text-xs\">\n            <div className=\"flex justify-between\">\n                <div className=\"w-1/3 text-left\">\n                    {prevExists && (\n                        <Link\n                            to={prevSlug}\n                            className=\"text-blue-500 hover:underline\"\n                        >\n                            &larr; Previous article\n                        </Link>\n                    )}\n                </div>\n                <div className=\"w-1/3 text-center\">\n                    <span>\n                        This is part {tutorial_number} of the{' '}\n                        <Link\n                            to=\"/probabilistic_linkage\"\n                            className=\"text-blue-500 hover:underline\"\n                        >\n                            tutorial\n                        </Link>\n                    </span>\n                </div>\n                <div className=\"w-1/3 text-right\">\n                    {nextExists && (\n                        <Link\n                            to={nextSlug}\n                            className=\"text-blue-500 hover:underline\"\n                        >\n                            Next article &rarr;\n                        </Link>\n                    )}\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default CompactTutorialNav;\n","import React, { useRef, useEffect } from 'react';\nimport { Runtime, Inspector, Library } from '@observablehq/runtime';\n\nconst mountId = 'mdx-container-div';\n\nconst stdlib = new Library();\n\nconst library = Object.assign({}, stdlib, { width: width_mdx });\n\nfunction width_mdx() {\n    return stdlib.Generators.observe(notify => {\n        let width1 = notify(document.getElementById(mountId).clientWidth);\n        function resized() {\n            let width2 = document.getElementById(mountId).clientWidth;\n            if (width2 !== width1) notify((width1 = width2));\n        }\n\n        window.addEventListener('resize', resized);\n        return () => window.removeEventListener('resize', resized);\n    });\n}\n\nfunction ObservableNotebook({ notebook, cells, customClassName }) {\n    const refs = useRef(cells.map(() => React.createRef()));\n\n    useEffect(() => {\n        const runtime = new Runtime(library);\n        runtime.module(notebook, name => {\n            const index = cells.indexOf(name);\n            if (index !== -1) {\n                return new Inspector(refs.current[index].current);\n            }\n        });\n        return () => runtime.dispose();\n    }, [notebook, cells]);\n\n    return (\n        <div className={customClassName}>\n            {refs.current.map((ref, index) => (\n                <div key={index} ref={ref} />\n            ))}\n        </div>\n    );\n}\n\nexport default ObservableNotebook;\n","import React from 'react';\nimport MDXLayout from './MDXLayout';\nimport TutorialNav from '../components/TutorialNav';\nimport CompactTutorialNav from '../components/CompactTutorialNav';\n\nexport function ProbLinkageLayout({ children, pageContext }) {\n    const { frontmatter } = pageContext;\n\n    const InnerContent = () => (\n        <div>\n            <CompactTutorialNav frontmatter={frontmatter} />\n            {children}\n            <TutorialNav frontmatter={frontmatter} />\n        </div>\n    );\n\n    return (\n        <MDXLayout pageContext={pageContext}>\n            <InnerContent />\n        </MDXLayout>\n    );\n}\n\nexport default ProbLinkageLayout;\n","import { graphql, useStaticQuery } from 'gatsby';\n\nexport const useSiteMetadata = () => {\n    const data = useStaticQuery(graphql`\n        query {\n            site {\n                siteMetadata {\n                    title\n                    description\n                    twitterUsername\n                    image\n                    siteUrl\n                }\n            }\n        }\n    `);\n\n    return data.site.siteMetadata;\n};\n","import React from 'react';\nimport { useSiteMetadata } from '../hooks/use-site-metadata';\n\nexport const SEO = ({ frontmatter }) => {\n    const {\n        title: defaultTitle,\n        description: defaultDescription,\n        image,\n        siteUrl,\n        twitterUsername,\n    } = useSiteMetadata();\n\n    const seo = {\n        title: frontmatter?.title || defaultTitle,\n        description: frontmatter?.description || defaultDescription,\n        image: `${siteUrl}${frontmatter?.image || image}`,\n        url: `${siteUrl}${frontmatter?.pathname || ``}`,\n        twitterUsername,\n        ...frontmatter,\n    };\n\n    const stylesheetLink = frontmatter?.stylesheet;\n\n    return (\n        <>\n            <title>{seo.title}</title>\n            <meta name=\"description\" content={seo.description} />\n            <meta name=\"image\" content={seo.image} />\n            {stylesheetLink && (\n                <link\n                    rel=\"stylesheet\"\n                    type=\"text/css\"\n                    href={`/styles/${stylesheetLink}`}\n                />\n            )}\n        </>\n    );\n};\n","import React from 'react';\nimport { Link, useStaticQuery, graphql } from 'gatsby';\n\nconst TutorialNav = ({ frontmatter }) => {\n    const { tutorial_number, title } = frontmatter;\n\n    const data = useStaticQuery(graphql`\n        query {\n            allMdx(filter: { frontmatter: { tutorial_number: { ne: null } } }) {\n                edges {\n                    node {\n                        frontmatter {\n                            tutorial_number\n                            title\n                        }\n                        fields {\n                            slug\n                        }\n                    }\n                }\n            }\n        }\n    `);\n\n    const sortedTutorials = data.allMdx.edges.sort(\n        (a, b) =>\n            a.node.frontmatter.tutorial_number -\n            b.node.frontmatter.tutorial_number\n    );\n\n    return (\n        <div className=\"bg-blue-100  p-4 mt-8  mb-4 rounded-lg \">\n            <div className=\"container mx-auto\">\n                <div className=\"text-blue-800 font-semibold text-base mb-2\">\n                    <Link\n                        to=\"/probabilistic_linkage\"\n                        className=\"text-blue-500 hover:underline\"\n                    >\n                        Probabilistic Linkage Tutorial Navigation:\n                    </Link>\n                </div>\n                <ol className=\"space-y-2 text-sm\">\n                    {sortedTutorials.map(edge => (\n                        <li\n                            key={edge.node.frontmatter.tutorial_number}\n                            className=\"text-blue-600 text-sm\"\n                        >\n                            {tutorial_number ===\n                            edge.node.frontmatter.tutorial_number ? (\n                                <span className=\"font-bold text-sm\">\n                                    {edge.node.frontmatter.title}\n                                </span>\n                            ) : (\n                                <Link\n                                    to={edge.node.fields.slug}\n                                    className=\"hover:underline\"\n                                >\n                                    {edge.node.frontmatter.title}\n                                </Link>\n                            )}\n                        </li>\n                    ))}\n                </ol>\n            </div>\n        </div>\n    );\n};\n\nexport default TutorialNav;\n"],"names":["_1","md","_2","async","_aq","require","aq_version","aq_packages","toView","aq","Promise","all","map","pkg","forEach","addPackage","addTableMethod","override","_aq_version","_aq_packages","_6","_op","_8","_9","_10","_11","_12","_dt","table","_14","_15","dt","op","derive","month","d","row_number","diff","Seattle","Chicago","select","orderby","view","height","_16","_17","rollup","corr_sf","corr","corr_chi","_18","_19","fold","as","groupby","min","sun","max","avg","average","med","median","skew","s","mean","stdev","objects","_20","_toView","html","DEFAULT_NULL","value","opt","limit","color","columnNames","name","key","td","index","row","maxCellWidth","size","null","style","th","toHTML","runtime","observer","main","module","variable","define","_Record","constructor","record_dict","this","as_dict","as_aq","from","display","_RecordComparison","record_l","record_r","as_long","records","as_wide","t_l","t_r","comparison","join","a","b","suffix","colname_no_suffix","cols_ordered","push","wide_or_long","child1","import","_3","_splink_settings","proportion_of_matches","comparison_columns","num_levels","col_name","u_probabilities","m_probabilities","_row","first_name_l","first_name_r","surname_l","surname_r","date_of_birth_l","other","_overrides","_7","get_waterfall_chart","splink_settings","overrides","_get_waterfall_chart","get_waterfall_chart_data","embed","get_chart_spec","chart_overrides","simplified","term_freqs","data","_get_comparison_column_lookup","lookup","_get_waterfall_chart_data","get_waterfall_data_lambda_row","get_waterfall_data_other_rows","get_waterfall_data_final_row","lambda_row","waterfall_data_other_rows","rows_except_final","concat","final_row","cumulative_log2_bayes_factor","reduce","_get_waterfall_row_gamma","get_comparison_column_lookup","log2","gamma_key","u_probability","m_probability","gamma_value","replace","this_cc","value_l","value_r","bayes_factor","column_name","gamma_column_name","gamma_index","level_name","log2_bayes_factor","_get_waterfall_data_lambda_row","prob_to_bayes_factor","prob_to_log2_bayes_factor","_get_waterfall_data_other_rows","get_waterfall_row_gamma","keys","Object","filter","includes","_get_waterfall_data_final_row","_get_chart_spec","base_spec","base_spec_2","JSON","parse","stringify","values","spec","type","field","condition","test","expr","format","title","_base_spec","config","continuousHeight","continuousWidth","text","subtitle","transform","window","frame","calculate","layer","mark","encoding","y","width","opacity","tooltip","x","axis","labelExpr","labelAlign","labelPadding","grid","tickBand","sort","orient","y2","fontWeight","labelAngle","baseline","dy","strokeWidth","x2Offset","xOffset","x2","scale","zero","resolve","step","$schema","_embed","_bayes_factor_to_prob","_log2","Math","_prob_to_bayes_factor","p","_prob_to_log2_bayes_factor","_log2_bayes_factor_to_prob","bayes_factor_to_prob","log2_b","_first_name_lookup","d3","csv","autoType","then","csv_file","firstname","freq","_term_freqs","first_name_lookup","first_name","_records_l","uid","fname","sname","dob","town","_records_r","_df_r","records_r","case_expression","fname_l","fname_r","sname_l","sname_r","dob_l","dob_r","town_l","town_r","_df_comparison","get_df_comparison","records_l","df_comparison","_df_gammas","get_df_gammas","df_gammas","get_df_e","_get_df_e","get_match_probability","df_e","df","relocate","after","_get_match_probability","prob_to_log2_bf","log2_bf_to_prob","settings","prior_log2_bg","log2_bayes","cc","gamma_col_name","gamma","m","u","l_val","toLowerCase","r_val","tfs","u_l","u_r","u_new","_get_match_probability_components","num_columns","undefined","length","slice","comparison_vector","gamma_symbols","m_values","u_values","m_symbols","u_symbols","bayes_factors","log2_bayes_factors","col_names","match_probability","lam","col_name_escaped","bf","_get_m_u_formula_numbers","get_match_probability_components","toPrecision","lam_m","lam_u","m_tex","u_tex","m_part","_get_m_u_formula_symbols","tex","get_m_u_formula_symbols","_get_comparison_vector_symbols_and_numbers","get_comparison_vector_symbols_and_numbers","get_m_u_formula_numbers","_21","_get_df_comparison","records_as_dict_l","records_as_dict_r","df_l","df_r","_get_df_gammas","col_order","_log2_bf_to_prob","_prob_to_log2_bf","_surname_lookup","surname","surname_lookup","_32","_33","_example_record_1_l","Record","date_of_birth","_example_record_1_r","_example_1_comparison","RecordComparison","example_record_1_l","example_record_1_r","_example_1_row_with_gammas","example_1_comparison","k","_intro_simple_waterfall","example_1_row_with_gammas","_parseTableData","replace_lookup","querySelectorAll","i","cells","row_data","cell","innerText","trim","accumulator","properties","rowObject","Generators","parseTableData","table_l","observe","notify","keyinput","event","addEventListener","removeEventListener","_table_l","_table_r","table_r","_df_1_l","_df_1_r","_df_comparisons_1","_df_gammas_1","df_comparisons_1","splink_settings_1","_df_gammas_only_1","df_gammas_1","colnames","_splink_settings_1","_example_record_2_l","month_of_birth","_example_record_2_r","_example_2_comparison","example_record_2_l","example_record_2_r","child2","child3","child4","_title","_para_1","_para_2","_para_3","_table_l1","_ds2_head","_table_r1","_rec_comparisons","_para_4","df_gammas_only_1","texd","_subhead_1","_para_5","_para_6","_para_7","_para_8","_subhead_2","_para_10","inputs","default_splink_settings","textarea","rows","spellcheck","_para_11","_row_index","range","numRows","label","_this_row","row_index","toMarkdown","_para_12","_para_13","_para_14","_para_15","_para_16","_para_17","_para_18","_para_19","_30","_texd","options","displayMode","fleqn","_default_splink_settings","_settings","_css_styles","_inputs","G","_","input","Head","props","React","SEO","frontmatter","pageContext","output_order","_createMdxContent","_components","assign","h1","_provideComponents","components","ObservableNotebook","notebook","MDXLayout","_ref","_data$allMdx$edges$fi","_data$allMdx$edges$fi2","_data$allMdx$edges$fi3","_data$allMdx$edges$fi4","_data$allMdx$edges$fi5","_data$allMdx$edges$fi6","tutorial_number","useStaticQuery","tutorials","allMdx","edges","edge","node","prevExists","nextExists","prevSlug","find","fields","slug","nextSlug","className","Link","to","mountId","stdlib","Library","library","width1","document","getElementById","clientWidth","resized","width2","customClassName","refs","useRef","useEffect","Runtime","indexOf","Inspector","current","dispose","ref","ProbLinkageLayout","children","InnerContent","CompactTutorialNav","TutorialNav","defaultTitle","description","defaultDescription","image","siteUrl","twitterUsername","site","siteMetadata","seo","url","pathname","stylesheetLink","stylesheet","content","rel","href","sortedTutorials"],"sourceRoot":""}